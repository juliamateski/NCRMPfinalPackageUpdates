---
title: "Analysis package data export (Julia's Version)"
author: "Julia Mateski"
date: "Feb 2025"
output: html_document
---
```{r}
library(readr)
library(tidyverse)
library(magrittr)
library(ncrmp.benthics.analysis)
library(devtools)
```
#### set working directory
```{r}
#user sets working directory
wd = "/Users/juliamateski/Downloads/NCRMPfinalPackageUpdates/"

#check if directory exists, return TRUE if it does exist
dir.exists(wd)

#set working directory for knitting
knitr::opts_knit$set(wd)

#set up project directory
usethis::proj_set(path = wd)

#get current project directory to verify that the project directory is set up correctly
usethis::proj_get()

```

#### Load new NTOT files, old strata, calculated from 50m grids
```{r}
# SEFL_2014_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_sefcri2014.csv") %>%
#   dplyr::select(-STAGE_LEVEL)
# SEFL_2016_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_sefcri2016.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
# SEFL_2018_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_sefcri2018.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
# SEFL_2020_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_sefcri2020.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
# SEFL_2022_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_sefcri2022.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
# 
# usethis::use_data(SEFL_2014_NTOT,  overwrite = TRUE)
# usethis::use_data(SEFL_2016_NTOT,  overwrite = TRUE)
# usethis::use_data(SEFL_2018_NTOT,  overwrite = TRUE)
# usethis::use_data(SEFL_2020_NTOT,  overwrite = TRUE)
# usethis::use_data(SEFL_2022_NTOT,  overwrite = TRUE)
# 
# FLK_2014_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_fk2014.csv") %>%
#   dplyr::select(-STAGE_LEVEL)
# FLK_2016_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_fk2016.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
# FLK_2018_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_fk2018.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
# FLK_2020_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_fk2020.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
#FLK_2022_NTOT <- FLK_2020_NTOT
#   dplyr::select(-STAGE_LEVEL)
# 
# usethis::use_data(FLK_2014_NTOT,  overwrite = TRUE)
# usethis::use_data(FLK_2016_NTOT,  overwrite = TRUE)
# usethis::use_data(FLK_2018_NTOT,  overwrite = TRUE)
# usethis::use_data(FLK_2020_NTOT,  overwrite = TRUE)
# usethis::use_data(FLK_2022_NTOT,  overwrite = TRUE)
# Tort_2014_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_dt2014.csv") %>%
#   dplyr::select(-STAGE_LEVEL)
# Tort_2016_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_dt2016.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
# Tort_2018_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_dt2018.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
# Tort_2020_NTOT <- read.csv("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\NCRMP\\NTOTs\\ntot_dt2020.csv")%>%
#   dplyr::select(-STAGE_LEVEL)
# 
# usethis::
use_data(Tort_2014_NTOT,  overwrite = TRUE)
# usethis::use_data(Tort_2016_NTOT,  overwrite = TRUE)
# usethis::use_data(Tort_2018_NTOT,  overwrite = TRUE)
# usethis::use_data(Tort_2020_NTOT,  overwrite = TRUE)
#usethis::use_data(Tort_2022_NTOT,  overwrite = TRUE)
usethis::use_data(FGBNMS_boundary, overwrite = TRUE)
```

#### file names
```{r}
species_level_metrics <- "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Species level metrics"
site_level_metrics <- "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics"
strata_level_metrics <- "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics"
domain_est <- "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates"

fig_path <- "K:/_BioGeoProjects/NCRMP/Data Analysis/Analysis ready data/Figures"
CV_path <- "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\CV"

invert <- "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates"


```

#### Coral Density

```{r}

coral_density <- function(region, project, species_filter = FALSE, start_year, end_year ){
  
  call_data <- NCRMP_DRM_calculate_colony_density(project = project, region = region, species_filter = species_filter)
  
    prep_csv <- function(dataset_name_string, dataset, location){
    
  if(region == "Tortugas"){ region = "Tort"}
  
  if(region == "GOM"){ region = "FGBNMS"}
    
    file_name <- paste(project, region, start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
    }
    
  prep_csv("density_species", call_data$density_species, species_level_metrics)  
  prep_csv("density_site", call_data$density_site, site_level_metrics)  
  prep_csv("density_strata", call_data$density_strata, strata_level_metrics)  
  prep_csv("density_region", call_data$Domain_est, domain_est)
}
```

```{r}
coral_density(region = "SEFCRI", project = "NCRMP", species_filter = FALSE, start_year = 2014, end_year =22 )
coral_density(region = "SEFCRI", project = "NCRMP_DRM", species_filter = FALSE, start_year = 2014, end_year =22 )


coral_density(region = "FLK", project = "NCRMP", species_filter = FALSE, start_year = 2014, end_year =22 )
coral_density(region = "FLK", project = "NCRMP_DRM", species_filter = FALSE, start_year = 2014, end_year =22 )


coral_density(region = "Tortugas", project = "NCRMP", species_filter = FALSE, start_year = 2014, end_year =22 )
coral_density(region = "Tortugas", project = "NCRMP_DRM", species_filter = FALSE, start_year = 2014, end_year =22 )
```

```{r}

coral_density(region = "STX", project = "NCRMP", species_filter = FALSE, start_year = 2015, end_year =23 )

coral_density(region = "PRICO", project = "NCRMP", species_filter = FALSE, start_year = 2014, end_year =23 )

coral_density(region = "STTSTJ", project = "NCRMP", species_filter = FALSE, start_year = 2013, end_year =23 )
```

```{r}
coral_density(region = "GOM", project = "NCRMP", species_filter = FALSE, start_year = 2013, end_year =23 )
```


##### Density CV and occurrence 

```{r}


density_CV_and_occ <- function(region_code, region_name, project, year){
  
  density_data <- NCRMP_DRM_colony_density_CV_and_occurrence(region = region_code,
                                              ptitle = region_name,
                                              project = project,
                                              year = year,
                                              file_path = fig_path,  
                                              species_filter = "NULL")
  
  if(region_code == "Tortugas"){ region_code = "Tort"}
  
  if(region_code == "GOM"){ region_code = "FGBNMS"}

save_file_dens_occ_cv <- function(file_name, data){
  assign(file_name, value = data, envir = .GlobalEnv)
  make_data_path <- paste(paste(CV_path, file_name, sep = "\\"), "csv", sep = ".")
  write_csv(get(file_name), make_data_path)
  final_data <- get(file_name)
  usethis::use_data(final_data, overwrite = TRUE)
}

region_means_file_name <- paste(project, region_code, "Occ_Den_CV", sep = "_")  
save_file_dens_occ_cv(region_means_file_name, density_data$region_means)

region_means_20_file_name <- paste(project, region_code, "Occ_Den_CV", 20, sep = "_")  
save_file_dens_occ_cv(region_means_20_file_name, density_data$region_means_cv20)
  
}

density_CV_and_occ(region_code = "Tortugas", region_name = "Dry Tortugas", project = "NCRMP", year = 2022)

```

###### Density t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_SEFCRI_2014_22_density_region,
                    metric1 = 'density',
                    metric2 = 'avDen',
                    alpha = 0.05,
                    test_type = "Years",
                    n_years = 4, # this needs to be updated in conjunction with updating the t test function to accommodate more years
                    return_dataframe = FALSE)
```
##### Density CV and occurrence 

##### Species richness 
```{r}
species_richness <- function(region, project, species_filter = FALSE, start_year, end_year ){
  
  call_data <- NCRMP_DRM_calculate_species_richness_diversity(project = project, region = region)
  
  prep_csv <- function(dataset_name_string, dataset, location){
    
  if(region == "Tortugas"){ region = "Tort"}
  
  if(region == "GOM"){ region = "FGBNMS"}
    
    file_name <- paste(project, region, start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }

  prep_csv("richness_site", call_data$richness_site, site_level_metrics)  
  prep_csv("richness_strata", call_data$richness_strata, strata_level_metrics)  
  prep_csv("richness_region", call_data$Domain_est, domain_est)
  prep_csv("diversity_site", call_data$species_diversity_site, site_level_metrics)
  prep_csv("diversity_strata", call_data$diversity_strata, strata_level_metrics)
  prep_csv("diversity_region", call_data$Domain_est_div, domain_est)
  

}

species_richness(region = "SEFCRI", project = "NCRMP", species_filter = FALSE, start_year = 2014, end_year =22 )


```

##### Percent cover
```{r}
percent_cover <- function(region, project, species_filter = FALSE, start_year, end_year ){
  
  call_data <- NCRMP_calculate_cover(project = project, region = region)
  

  
  prep_csv <- function(dataset_name_string, dataset, location){
    
  if(region == "Tortugas"){ region = "Tort"}
  
  if(region == "GOM"){ region = "FGBNMS"}
    
    file_name <- paste(project, region, start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }


  prep_csv("percent_cover_species", call_data$percent_cover_species, species_level_metrics)  
  prep_csv("percent_cover_site", call_data$percent_cover_site, site_level_metrics)  
  #prep_csv("cover_group_key", call_data$cover_group_key, domain_est)
  prep_csv("cover_strata", call_data$cover_strata, strata_level_metrics)
  prep_csv("cover_region", call_data$Domain_est, domain_est)
  #prep_csv("Domain_check", call_data$Domain_check, domain_est)

}

percent_cover(region = "FLK", project = "NCRMP", species_filter = FALSE, start_year = 2014, end_year =22 )
```
#### check equal
```{r}
output1 <- NCRMP_SEFCRI_2014_22_old_mort_site_1
output2 <- NCRMP_SEFCRI_2014_22_old_mort_site

# Compare outputs
identical(output1, output2)  # Checks if they are exactly the same

# If there might be minor differences (e.g., numerical precision)
all.equal(output1, output2, tolerance = 1e-10)
  # Returns TRUE if they are nearly identical, or a description of differences

```
#### colony percent cover
```{r}
colony_percent_cover <- function(region_code, region_name, project, start_year, end_year){
  
  
  data <- NCRMP_colony_percent_cover(region = region_code,
                                              ptitle = region_name,
                                              file_path = fig_path,
                                             project = project)
  
  
  if(region_code == "Tortugas"){ region_code = "Tort"}
  
  if(region_code == "GOM"){ region_code = "FGBNMS"}

  file_name <- paste(project, region_code, start_year, end_year, "percent_cover_region_species", sep = "_")
  assign(file_name, value = data$region_means, envir = .GlobalEnv)
  make_data_path <- paste(paste(CV_path, file_name, sep = "\\"), "csv", sep = ".")
  write_csv(get(file_name), make_data_path)
  final_data <- get(file_name)
  usethis::use_data(final_data, overwrite = TRUE)
  
}

colony_percent_cover(region_code = "SEFCRI", region_name = "Southeast Florida", project = "NCRMP", 2014, 22)

```

####density t test
```{r}

get_density_ttest_data <- function(region){
  
    dataframe = switch(region,
                     "SEFCRI" = NCRMP_SEFCRI_2014_22_density_region,
                     "FLK" = NCRMP_FLK_2014_22_density_region,
                     "Tortugas" = NCRMP_Tortugas_2014_22_density_region,

  )
  
NCRMP_perform_ttest(dataframe = NCRMP_FLK_2014_22_density_region,
                    metric1 = 'density',
                    metric2 = 'avDen',
                    alpha = 0.05,
                    test_type = "Years",
                    n_years = 4, # this needs to be updated in conjunction with updating the t test function to accommodate more years
                    return_dataframe = FALSE)
  
}
```

#### avCvr ttest
```{r}

get_avCvr_ttest_data <- function(region){
  
  dataframe = switch(region,
                     "SEFCRI" = NCRMP_SEFCRI_2014_22_cover_region,
                     "FLK" = NCRMP_FLK_2014_22_cover_region,
                     "Tortugas" = NCRMP_Tort_2014_22_cover_region,

  )
  
print("coral cover t-test results")

NCRMP_perform_ttest(dataframe = dataframe,
                    metric1 = 'coral_cover',
                    metric2 = 'avCvr',
                    alpha = 0.05,
                    #test_type = "Years",
                    n_years = 4,
                    return_dataframe = FALSE)

print("macroalgae cover t-test results")

NCRMP_perform_ttest(dataframe = dataframe,
                    metric1 = 'macroalgae_cover',
                    metric2 = 'avCvr',
                    alpha = 0.05,
                    #test_type = "Years",
                    n_years = 4,
                    return_dataframe = FALSE)

}

get_ttest_data("SEFCRI")


```

##### Mortality
```{r}

mortality <- function(region, project, species_filter = FALSE, start_year, end_year ){
  
  call_data <- NCRMP_DRM_calculate_mortality(project = project, region = region)
  
  prep_csv <- function(dataset_name_string, dataset, location){
    
  if(region == "Tortugas"){ region = "Tort"}
  
  if(region == "GOM"){ region = "FGBNMS"}
    
    file_name <- paste(project, region, start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    unique(call_data$ntot_check_rec_mort_species$wh_sum)
    unique(call_data$ntot_check_old_mort_species$wh_sum)
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }

  prep_csv("old_mort_site", call_data$old_mortality_site, site_level_metrics)  
  prep_csv("rec_mort_site", call_data$recent_mortality_site, site_level_metrics)  
  prep_csv("old_mort_strata", call_data$old_mortality_strata, strata_level_metrics)  
  prep_csv("rec_mort_strata", call_data$rec_mortality_strata, strata_level_metrics)  
  prep_csv("old_mort_region", call_data$Domain_est_old_mort, domain_est)
  prep_csv("rec_mort_region", call_data$Domain_est_rec_mort, site_level_metrics)
  prep_csv("old_mort_species_region", call_data$Domain_est_old_mort_species, strata_level_metrics)
  prep_csv("rec_mort_species_region", call_data$Domain_est_rec_mort_species, domain_est)

}

mortality(region = "SEFCRI", project = "NCRMP_DRM", species_filter = FALSE, start_year = 2014, end_year =22 )

```

##### Disease and bleaching - Colonies
```{r}
disease_prev_colonies <- function(region, project, species_filter = FALSE, start_year, end_year ){
  
  call_data <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = project,
                                                       region = region,
                                                       species_filter = "FALSE")
  
  
  prep_csv <- function(dataset_name_string, dataset, location){
    
  if(region == "Tortugas"){ region = "Tort"}
  
  if(region == "GOM"){ region = "FGBNMS"}
    
    file_name <- paste(project, region, start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }

  prep_csv("dis_ble_prev_species", call_data$dis_ble_prev_species, species_level_metrics) 
  prep_csv("dis_ble_prev_site", call_data$dis_ble_prev_site, site_level_metrics)  
  prep_csv("dis_prev_strata", call_data$dis_prev_strata, strata_level_metrics)  
  prep_csv("ble_prev_strata", call_data$ble_prev_strata, strata_level_metrics)
  prep_csv("dis_ble_prev_region", call_data$Domain_est, domain_est)
  

}

disease_prev_colonies(region = 'SEFCRI', project = "NCRMP", species_filter = FALSE, start_year = 2014, end_year =22)
```
##### Disease and bleaching - Species Domain
```{r}

disease_ble_species_domain <- function(region, project, species_filter = FALSE, start_year, end_year ){
  
  call_data <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project=project,
                                                             region = region)
  
  
  prep_csv <- function(dataset_name_string, dataset, location){
    
  if(region == "Tortugas"){ region = "Tort"}
  
  if(region == "GOM"){ region = "FGBNMS"}
    
    unique(call_data$ntot_check$wh_total)
    
    file_name <- paste(project, region, start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }


  prep_csv("dis_prev_species_region", call_data$DomainEst_dis, domain_est)
  prep_csv("ble_prev_species_region", call_data$DomainEst_bl, domain_est)
  


}

disease_ble_species_domain(region = "SEFCRI", project = "NCRMP", species_filter = FALSE, start_year = 2014, end_year = 22 )
```

##### Disease and bleaching - Sites
```{r}
disease_ble_sites <- function(region, project, species_filter = FALSE, start_year, end_year ){
  
  call_data <- NCRMP_DRM_calculate_disease_prevalence_sites(project=project,
                                                             region = region, species_filter = species_filter)
  
  
  prep_csv <- function(dataset_name_string, dataset, location){
    
  if(region == "Tortugas"){ region = "Tort"}
  
  if(region == "GOM"){ region = "FGBNMS"}
    

    
    file_name <- paste(project, region, start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }


  prep_csv("dis_ble_PA_site", call_data$dis_ble_prev_site, site_level_metrics)
  prep_csv("dis_n_sites_per_strata", call_data$dis_ble_prev_strata, strata_level_metrics)
  prep_csv("dis_ble_n_sites_per_region", call_data$disease_prev_region, domain_est)
  


}

disease_ble_sites(region = "SEFCRI", project = "NCRMP_DRM", species_filter = FALSE, start_year = 2014, end_year = 22 )
```

####Colony Size

```{r}
colony_size <- function(region, project, species_filter = FALSE, start_year, end_year ){
  
  call_data <- NCRMP_DRM_calculate_mean_colony_size(project=project,
                                                             region = region, species_filter = "FALSE")
  

  
  prep_csv <- function(dataset_name_string, dataset, location){
    
  if(region == "Tortugas"){ region = "Tort"}
  
  if(region == "GOM"){ region = "FGBNMS"}
    

    
    file_name <- paste(project, region, start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }
  
  
  prep_csv("col_size_region_species", call_data$Domain_est_species, domain_est)
  
  
if(project == "NCRMP"){

  prep_csv("col_size_species", call_data$size_species, site_level_metrics)
  prep_csv("col_size_site", call_data$size_site, site_level_metrics)
  prep_csv("col_size_cm2_strata", call_data$size_est_cm2_strata, strata_level_metrics)
   prep_csv("col_size_cm3_strata", call_data$size_est_cm3_strata, strata_level_metrics)
   prep_csv("col_size_region", call_data$Domain_est, domain_est)
   prep_csv("col_size_region_species", call_data$Domain_est_species, domain_est)
}
  
}


colony_size(region = "SEFCRI", project = "NCRMP_DRM", species_filter = FALSE, start_year = 2014, end_year = 22 )
```

##### Diadema density
```{r}
diadema <- function(region, project = "NCRMP", species_filter = FALSE, start_year, end_year ){
  
  call_data <- NCRMP_calculate_invert_density(region = region)
  

  
  prep_csv <- function(dataset_name_string, dataset, location){
    
  if(region == "Tortugas"){ region = "Tort"}
  
  if(region == "GOM"){ region = "FGBNMS"}
    

    
    file_name <- paste(project, region, start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }
  
  
  NCRMP_SEFCRI_2014_22_invert_den_site <- call_data$diadema_density_site
NCRMP_SEFCRI_2014_22_invert_den_strata <- call_data$invert_strata # Right now just diadema
NCRMP_SEFCRI_2014_22_invert_den_region <- call_data$Domain_est


  prep_csv("invert_den_site", call_data$diadema_density_site, invert)
  prep_csv("invert_den_strata", call_data$invert_strata, invert)
  prep_csv("invert_den_region", call_data$Domain_est, invert)


   
}


diadema(region = "SEFCRI", species_filter = FALSE, start_year = 2014, end_year = 22 )
```



#JUST NEED CHECKING

###### Species
```{r}
# Run function and assign names to dataframes 
tmp <-NCRMP_colony_percent_cover(region = "FLK",
                                 ptitle = "The Florida Keys",
                                 file_path = "K:/_BioGeoProjects/NCRMP/Data Analysis/Analysis ready data/Figures" )
NCRMP_FLK_2014_22_percent_cover_region_species <- tmp$region_means
# Export data 
write.csv(NCRMP_FLK_2014_22_percent_cover_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_percent_cover_region_species.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FLK_2014_22_percent_cover_region_species,  overwrite = TRUE)
```
##### Mortality - NCRMP only
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_mortality(project = "NCRMP",
                                     region = "FLK",
                                     species_filter = "FALSE")
NCRMP_FLK_2014_22_old_mort_site <- tmp$old_mortality_site
NCRMP_FLK_2014_22_rec_mort_site <- tmp$recent_mortality_site
NCRMP_FLK_2014_22_old_mort_strata <- tmp$old_mortality_strata
NCRMP_FLK_2014_22_rec_mort_strata <- tmp$rec_mortality_strata
NCRMP_FLK_2014_22_old_mort_region <- tmp$Domain_est_old_mort
NCRMP_FLK_2014_22_rec_mort_region <- tmp$Domain_est_rec_mort
NCRMP_FLK_2014_22_old_mort_species_region <- tmp$Domain_est_old_mort_species
NCRMP_FLK_2014_22_rec_mort_species_region <- tmp$Domain_est_rec_mort_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_rec_mort_species$wh_sum)
unique(tmp$ntot_check_old_mort_species$wh_sum)
# Export data 
write.csv(NCRMP_FLK_2014_22_old_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FLK_2014_22_old_mort_site.csv", row.names = F) 
write.csv(NCRMP_FLK_2014_22_rec_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FLK_14_22_rec_mort_site.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_old_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FLK_2014_22_old_mort_strata.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_rec_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FLK_2014_22_rec_mort_strata.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_old_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_old_mort_region.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_rec_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_rec_mort_region.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_old_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_old_mort_species_region.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_rec_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_rec_mort_species_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FLK_2014_22_rec_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_old_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_rec_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_old_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_rec_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_old_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_old_mort_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_rec_mort_species_region,  overwrite = TRUE)
```
##### DRM Mortality - NCRMP + DRM 
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_mortality(project = "NCRMP_DRM",
                                     region = "FLK",
                                     species_filter = "FALSE")
NCRMP_DRM_FLK_2014_22_old_mort_site <- tmp$old_mortality_site
NCRMP_DRM_FLK_2014_22_rec_mort_site <- tmp$recent_mortality_site
NCRMP_DRM_FLK_2014_22_old_mort_strata <- tmp$old_mortality_strata
NCRMP_DRM_FLK_2014_22_rec_mort_strata <- tmp$rec_mortality_strata
NCRMP_DRM_FLK_2014_22_old_mort_region <- tmp$Domain_est_old_mort
NCRMP_DRM_FLK_2014_22_rec_mort_region <- tmp$Domain_est_rec_mort
NCRMP_DRM_FLK_2014_22_old_mort_species_region <- tmp$Domain_est_old_mort_species
NCRMP_DRM_FLK_2014_22_rec_mort_species_region <- tmp$Domain_est_rec_mort_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_rec_mort_species$wh_sum)
unique(tmp$ntot_check_old_mort_species$wh_sum)
# Export data 
write.csv(NCRMP_DRM_FLK_2014_22_old_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_DRM_FLK_2014_22_old_mort_site.csv", row.names = F) 
write.csv(NCRMP_DRM_FLK_2014_22_rec_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_DRM_FLK_2014_22_rec_mort_site.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_old_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_FLK_2014_22_old_mort_strata.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_rec_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_FLK_2014_22_rec_mort_strata.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_old_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_FLK_2014_22_old_mort_region.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_rec_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_FLK_2014_22_rec_mort_region.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_old_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_FLK_2014_22_old_mort_species_region.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_rec_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_FLK_2014_22_rec_mort_species_region.csv", row.names = F)
usethis::use_data(NCRMP_DRM_FLK_2014_22_rec_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_old_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_rec_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_old_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_rec_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_old_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_old_mort_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_rec_mort_species_region,  overwrite = TRUE)
```
##### Disease and bleaching - NCRMP only
```{r}
tmp <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = "NCRMP",
                                                       region = "FLK",
                                                       species_filter = "FALSE")
NCRMP_FLK_2014_22_dis_ble_prev_species <- tmp$dis_ble_prev_species
NCRMP_FLK_2014_22_dis_ble_prev_site <- tmp$dis_ble_prev_site
NCRMP_FLK_2014_22_dis_prev_strata <- tmp$dis_prev_strata
NCRMP_FLK_2014_22_ble_prev_strata <- tmp$ble_prev_strata
NCRMP_FLK_2014_22_dis_ble_prev_region <- tmp$Domain_est
# Export data
write.csv(NCRMP_FLK_2014_22_dis_ble_prev_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FLK_2014_22_dis_ble_prev_species.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_dis_ble_prev_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FLK_2014_22_dis_ble_prev_site.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_dis_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FLK_2014_22_dis_prev_strata.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_ble_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FLK_2014_22_ble_prev_strata.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_dis_ble_prev_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_dis_ble_prev_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FLK_2014_22_dis_ble_prev_species,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_dis_ble_prev_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_dis_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_ble_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_dis_ble_prev_region,  overwrite = TRUE)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project="NCRMP",
                                                             region = "FLK")
NCRMP_FLK_2014_22_dis_prev_species_region <- tmp$DomainEst_dis
NCRMP_FLK_2014_22_ble_prev_species_region <- tmp$DomainEst_bl
# ntot check - wh_total should always be 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check$wh_total)
write.csv(NCRMP_FLK_2014_22_dis_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_dis_prev_species_region.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_ble_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_ble_prev_species_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FLK_2014_22_dis_prev_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_ble_prev_species_region,  overwrite = TRUE)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_disease_prevalence_sites(project = "NCRMP",
                                                    region = "FLK",
                                                    species_filter = "FALSE")
NCRMP_FLK_2014_22_dis_ble_PA_site <- tmp$dis_ble_prev_site
NCRMP_FLK_2014_22_dis_n_sites_per_strata <- tmp$dis_ble_prev_strata
NCRMP_FLK_2014_22_dis_ble_n_sites_per_region <- tmp$disease_prev_region
write.csv(NCRMP_FLK_2014_22_dis_ble_PA_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FLK_2014_22_dis_ble_PA_site.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_dis_n_sites_per_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FLK_2014_22_dis_n_sites_per_strata.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_dis_ble_n_sites_per_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_dis_ble_n_sites_per_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FLK_2014_22_dis_ble_PA_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_dis_n_sites_per_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_dis_ble_n_sites_per_region,  overwrite = TRUE)
```
##### DRM Disease prevalence - NCRMP + DRM 
```{r}
tmp <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = "NCRMP_DRM",
                                                       region = "FLK",
                                                       species_filter = "FALSE")
NCRMP_DRM_FLK_2014_22_dis_ble_prev_species <- tmp$dis_ble_prev_species
NCRMP_DRM_FLK_2014_22_dis_ble_prev_site <- tmp$dis_ble_prev_site
NCRMP_DRM_FLK_2014_22_dis_prev_strata <- tmp$dis_prev_strata
NCRMP_DRM_FLK_2014_22_ble_prev_strata <- tmp$ble_prev_strata
NCRMP_DRM_FLK_2014_22_dis_ble_prev_region <- tmp$Domain_est
# Export data
write.csv(NCRMP_DRM_FLK_2014_22_dis_ble_prev_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Species level metrics\\NCRMP_DRM_FLK_2014_22_dis_ble_prev_species.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_dis_ble_prev_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_DRM_FLK_2014_22_dis_ble_prev_site.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_dis_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_FLK_2014_22_dis_prev_strata.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_ble_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_FLK_2014_22_ble_prev_strata.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_dis_ble_prev_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_FLK_2014_22_dis_ble_prev_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_DRM_Tort_2014_22_dis_ble_prev_species,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_dis_ble_prev_site,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_dis_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_ble_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_dis_ble_prev_region,  overwrite = TRUE)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project="NCRMP_DRM",
                                                             region = "FLK")
NCRMP_DRM_FLK_2014_22_dis_prev_species_region <- tmp$DomainEst_dis
NCRMP_DRM_FLK_2014_22_ble_prev_species_region <- tmp$DomainEst_bl
# ntot check - wh_total should always be 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check$wh_total)
write.csv(NCRMP_DRM_FLK_2014_22_dis_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_FLK_2014_22_dis_prev_species_region.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_ble_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_FLK_2014_22_ble_prev_species_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_DRM_FLK_2014_22_dis_prev_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_ble_prev_species_region,  overwrite = TRUE)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_disease_prevalence_sites(project = "NCRMP_DRM",
                                                    region = "FLK",
                                                    species_filter = "FALSE")
NCRMP_DRM_FLK_2014_22_dis_ble_PA_site <- tmp$dis_ble_prev_site
NCRMP_DRM_FLK_2014_22_dis_n_sites_per_strata <- tmp$dis_ble_prev_strata
NCRMP_DRM_FLK_2014_22_dis_ble_n_sites_per_region <- tmp$disease_prev_region
write.csv(NCRMP_DRM_FLK_2014_22_dis_ble_PA_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_DRM_FLK_2014_22_dis_ble_PA_site.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_dis_n_sites_per_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_FLK_2014_22_dis_n_sites_per_strata.csv", row.names = F)
write.csv(NCRMP_DRM_FLK_2014_22_dis_ble_n_sites_per_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_FLK_2014_22_dis_ble_n_sites_per_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_DRM_FLK_2014_22_dis_ble_PA_site,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_dis_n_sites_per_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_FLK_2014_22_dis_ble_n_sites_per_region,  overwrite = TRUE)
```
##### Colony size - NCRMP only  
```{r}
tmp <- NCRMP_DRM_calculate_mean_colony_size(project = "NCRMP",
                                            region = "FLK",
                                            species_filter = "FALSE")
NCRMP_FLK_2014_22_col_size_species <- tmp$size_species
NCRMP_FLK_2014_22_col_size_site <- tmp$size_site
NCRMP_FLK_2014_22_col_size_cm2_strata <- tmp$size_est_cm2_strata
NCRMP_FLK_2014_22_col_size_cm3_strata <- tmp$size_est_cm3_strata
NCRMP_FLK_2014_22_col_size_region <- tmp$Domain_est
NCRMP_FLK_2014_22_col_size_region_species <- tmp$Domain_est_species
# species-specific ntot check
unique(tmp$ntot_check_species$wh_sum)
# Export data
write.csv(NCRMP_FLK_2014_22_col_size_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FLK_2014_22_col_size_species.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_col_size_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FLK_2014_22_col_size_site.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_col_size_cm2_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FLK_2014_22_col_size_cm2_strata.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_col_size_cm3_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FLK_2014_22_col_size_cm3_strata.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_col_size_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_col_size_region.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_col_size_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FLK_2014_22_col_size_region_species.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FLK_2014_22_col_size_species,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_col_size_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_col_size_cm2_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_col_size_cm3_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_col_size_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_col_size_region_species,  overwrite = TRUE)
```
##### Colony size - NCRMP + DRM 
```{r}
tmp <- NCRMP_DRM_calculate_mean_colony_size(project = "NCRMP_DRM",
                                            region = "FLK",
                                            species_filter = "FALSE")
NCRMP_DRM_FLK_2014_22_col_size_region_species <- tmp$Domain_est_species
# species-specific ntot check
unique(tmp$ntot_check_species$wh_sum)
write.csv(NCRMP_DRM_FLK_2014_22_col_size_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_FLK_2014_22_col_size_region_species.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_DRM_FLK_2014_22_col_size_region_species,  overwrite = TRUE)
```
##### Diadema density  
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_calculate_invert_density(region = "FLK", project = "NCRMP")
NCRMP_FLK_2014_22_invert_den_site <- tmp$diadema_density_site
NCRMP_FLK_2014_22_invert_den_strata <- tmp$invert_strata # Right now just diadema
NCRMP_FLK_2014_22_invert_den_region <- tmp$Domain_est
# Export data 
write.csv(NCRMP_FLK_2014_22_invert_den_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_FLK_2014_22_invert_den_site.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_invert_den_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_FLK_2014_22_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_FLK_2014_22_invert_den_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_FLK_2014_22_invert_den_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FLK_2014_22_invert_den_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_invert_den_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FLK_2014_22_invert_den_region,  overwrite = TRUE)
# Don't forget to delete the previous years output in the R package and in the Data Queries folder 
```
### FLK - MIR
##### Coral density 
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_colony_density(project = "MIR", 
                                          region = "FLK",
                                          species_filter = "FALSE")
MIR_2022_density_species_DUMMY <- tmp$density_species
MIR_2022_density_site_DUMMY <- tmp$density_site
MIR_2022_density_strata_DUMMY <- tmp$density_strata
MIR_2022_density_region_DUMMY <- tmp$Domain_est
MIR_2022_density_PROT_DUMMY <- tmp$Domain_est_PROT
# Export data 
# write.csv(MIR_2022_density_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Species level metrics\\MIR_2022_density_species.csv", row.names = F)
# 
# write.csv(MIR_2022_density_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\MIR_2022_density_site.csv", row.names = F)
# 
# write.csv(MIR_2022_density_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\MIR_2022_density_strata.csv", row.names = F)
# 
# write.csv(MIR_2022_density_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_density_region.csv", row.names = F)
# These lines need to be run in the console, not the code chunk
usethis::use_data(MIR_2022_density_species_DUMMY,  overwrite = TRUE)
usethis::use_data(MIR_2022_density_site_DUMMY,  overwrite = TRUE)
usethis::use_data(MIR_2022_density_strata_DUMMY,  overwrite = TRUE)
usethis::use_data(MIR_2022_density_region_DUMMY,  overwrite = TRUE)
```
###### Density t-test
```{r}
NCRMP_perform_ttest(dataframe = MIR_2022_density_PROT_DUMMY,
                    metric1 = 'density',
                    metric2 = 'avDen',
                    alpha = 0.05,
                    test_type = "PROT",
                    return_dataframe = FALSE)
# The output for this is printing PROT = 1 and 2 rather than 0 and 1 (maybe it is printing the row name and not the value?) but the test is correct and maybe if you are reading this you can fix the problem. It prints correctly when I run it manually in the function. 
```
##### Density CV and occurrence 
```{r}
tmp <- NCRMP_colony_density_CV_and_occurrence(region = "FLK",
                                              ptitle = "MIR - Florida Keys - DUMMY",
                                              file_path = "K:/_BioGeoProjects/NCRMP/Data Analysis/Analysis ready data/Figures" ,  #must be connected to VPN if filepath is to a network drive
                                              species_filter = "NULL",
                                              project = "MIR")
MIR_FLK_Occ_Den_CV_DUMMY <- tmp$region_means
MIR_FLK_Occ_Den_CV_20_DUMMY <- tmp$region_means_cv20
# write.csv(MIR_FLK_Occ_Den_CV, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\CV\\MIR_FLK_Occ_Den_CV.csv", row.names = F)
# write.csv(MIR_FLK_Occ_Den_CV_20, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\CV\\MIR_FLK_Occ_Den_CV_20.csv", row.names = F)
usethis::use_data(MIR_FLK_Occ_Den_CV,  overwrite = TRUE)
usethis::use_data(MIR_FLK_Occ_Den_CV_20,  overwrite = TRUE)
```
##### Percent cover
###### Region 
```{r}
# Run function and assign names to data frames 
tmp <- NCRMP_calculate_cover(region = "FLK", project = "MIR")
MIR_2022_percent_cover_species_DUMMY <- tmp$percent_cover_species
MIR_2022_percent_cover_site <- tmp$percent_cover_site
MIR_2022_cover_group_key <- tmp$cover_group_key
MIR_2022_cover_strata <- tmp$cover_strata
MIR_2022_cover_region <- tmp$Domain_est
MIR_2022_Domain_check <- tmp$Domain_check # Make sure your cover groups add up to close to 100%
cover_check_site <- tmp$cover_check_site # Make sure each sites has total percent cover of 100%; this will always be off for some 2014 sites - transects 1 and 2 were given different habitats. 
# For the domain check, if this number if not very close to 100, there is likely something wrong with your ntot. Any strata that was not sampled that year needs to be removed from the ntot BEFORE ngrot is calculated. Slight variations from 100 could be due to using the most recent NTOT file for past years, this is ok.
# Export data 
write.csv(MIR_2022_percent_cover_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Species level metrics\\MIR_2022_percent_cover_species.csv", row.names = F)
write.csv(MIR_2022_percent_cover_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\MIR_2022_percent_cover_site.csv", row.names = F)
write.csv(MIR_2022_cover_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\MIR_2022_cover_strata.csv", row.names = F)
write.csv(MIR_2022_cover_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_cover_region.csv", row.names = F)
#usethis::use_data(MIR_2022_percent_cover_species,  overwrite = TRUE) # use this not currently working, not sure why. Use save() to write to the /data folder and then update the package.
save(MIR_2022_percent_cover_species_DUMMY, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_percent_cover_species.rda")
#usethis::use_data(MIR_2022_percent_cover_site,  overwrite = TRUE)
save(MIR_2022_percent_cover_site, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_percent_cover_site.rda")
#usethis::use_data(MIR_2022_cover_strata,  overwrite = TRUE)
save(MIR_2022_cover_strata, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_cover_strata.rda")
#usethis::use_data(MIR_2022_cover_region,  overwrite = TRUE)
save(MIR_2022_cover_region, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_cover_region.rda")
```
###### Species
```{r}
# Run function and assign names to dataframes 
tmp <-NCRMP_colony_percent_cover(region = "FLK",
                                 ptitle = "MIR - Florida Keys - DUMMY",
                                 file_path = "K:/_BioGeoProjects/NCRMP/Data Analysis/Analysis ready data/Figures",
                                 project = "MIR")
MIR_2022_percent_cover_region_species <- tmp$region_means
# Export data 
write.csv(MIR_2022_percent_cover_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_percent_cover_region_species.csv", row.names = F)
#usethis::use_data(MIR_2022_percent_cover_region_species,  overwrite = TRUE)
save(MIR_2022_percent_cover_region_species, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_percent_cover_region_species.rda")
```
##### Mortality 
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_mortality(project = "MIR",
                                     region = "FLK",
                                     species_filter = "FALSE")
MIR_2022_old_mort_site_DUMMY <- tmp$old_mortality_site
MIR_2022_rec_mort_site_DUMMY <- tmp$recent_mortality_site
MIR_2022_old_mort_strata_DUMMY <- tmp$old_mortality_strata
MIR_2022_rec_mort_strata_DUMMY <- tmp$rec_mortality_strata
MIR_2022_old_mort_region_DUMMY <- tmp$Domain_est_old_mort
MIR_2022_rec_mort_region_DUMMY <- tmp$Domain_est_rec_mort
# Export data 
write.csv(MIR_2022_old_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\MIR_2022_old_mort_site.csv", row.names = F) 
write.csv(MIR_2022_rec_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FLK_14_18_rec_mort_site.csv", row.names = F)
write.csv(MIR_2022_old_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\MIR_2022_old_mort_strata.csv", row.names = F)
write.csv(MIR_2022_rec_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\MIR_2022_rec_mort_strata.csv", row.names = F)
write.csv(MIR_2022_old_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_old_mort_region.csv", row.names = F)
write.csv(MIR_2022_rec_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_rec_mort_region.csv", row.names = F)
usethis::use_data(MIR_2022_rec_mort_site,  overwrite = TRUE)
usethis::use_data(MIR_2022_old_mort_site,  overwrite = TRUE)
usethis::use_data(MIR_2022_rec_mort_strata,  overwrite = TRUE)
usethis::use_data(MIR_2022_old_mort_strata,  overwrite = TRUE)
usethis::use_data(MIR_2022_rec_mort_region,  overwrite = TRUE)
usethis::use_data(MIR_2022_old_mort_region,  overwrite = TRUE)
```
##### Disease and bleaching 
```{r}
tmp <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = "MIR",
                                                       region = "FLK",
                                                       species_filter = "FALSE")
MIR_2022_dis_ble_prev_species_DUMMY <- tmp$dis_ble_prev_species
MIR_2022_dis_ble_prev_site <- tmp$dis_ble_prev_site
MIR_2022_dis_prev_strata <- tmp$dis_prev_strata
MIR_2022_ble_prev_strata <- tmp$ble_prev_strata
MIR_2022_dis_ble_prev_region <- tmp$Domain_est
# Export data
write.csv(MIR_2022_dis_ble_prev_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\MIR_2022_dis_ble_prev_species.csv", row.names = F)
write.csv(MIR_2022_dis_ble_prev_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\MIR_2022_dis_ble_prev_site.csv", row.names = F)
write.csv(MIR_2022_dis_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\MIR_2022_dis_prev_strata.csv", row.names = F)
write.csv(MIR_2022_ble_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\MIR_2022_ble_prev_strata.csv", row.names = F)
write.csv(MIR_2022_dis_ble_prev_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_dis_ble_prev_region.csv", row.names = F)
# usethis::use_data(MIR_2022_dis_ble_prev_species,  overwrite = TRUE)
save(MIR_2022_dis_ble_prev_species_DUMMY, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_dis_ble_prev_species_DUMMY.rda")
# usethis::use_data(MIR_2022_dis_ble_prev_site,  overwrite = TRUE)
save(MIR_2022_dis_ble_prev_site, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_dis_ble_prev_site.rda")
# usethis::use_data(MIR_2022_dis_prev_strata,  overwrite = TRUE)
save(MIR_2022_dis_prev_strata, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_dis_prev_strata.rda")
# usethis::use_data(MIR_2022_ble_prev_strata,  overwrite = TRUE)
save(MIR_2022_ble_prev_strata, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_ble_prev_strata.rda")
# usethis::use_data(MIR_2022_dis_ble_prev_region,  overwrite = TRUE)
save(MIR_2022_dis_ble_prev_region, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_dis_ble_prev_region.rda")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project="MIR",
                                                             region = "FLK")
MIR_2022_dis_prev_species_region <- tmp$DomainEst_dis
MIR_2022_ble_prev_species_region <- tmp$DomainEst_bl
write.csv(MIR_2022_dis_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_dis_prev_species_region.csv", row.names = F)
write.csv(MIR_2022_ble_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_ble_prev_species_region.csv", row.names = F)
#usethis::use_data(MIR_2022_dis_prev_species_region,  overwrite = TRUE)
save(MIR_2022_dis_prev_species_region, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_dis_prev_species_region.rda")
#usethis::use_data(MIR_2022_ble_prev_species_region,  overwrite = TRUE)
save(MIR_2022_ble_prev_species_region, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_ble_prev_species_region.rda")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_disease_prevalence_sites(project = "MIR",
                                                    region = "FLK",
                                                    species_filter = "FALSE")
MIR_2022_dis_ble_PA_site <- tmp$dis_ble_prev_site
MIR_2022_dis_n_sites_per_strata <- tmp$dis_ble_prev_strata
MIR_2022_dis_ble_n_sites_per_region <- tmp$disease_prev_region
write.csv(MIR_2022_dis_ble_PA_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\MIR_2022_dis_ble_PA_site.csv", row.names = F)
write.csv(MIR_2022_dis_n_sites_per_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\MIR_2022_dis_n_sites_per_strata.csv", row.names = F)
write.csv(MIR_2022_dis_ble_n_sites_per_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_dis_ble_n_sites_per_region.csv", row.names = F)
#usethis::use_data(MIR_2022_dis_ble_PA_site,  overwrite = TRUE)
save(MIR_2022_ble_prev_species_region, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_ble_prev_species_region.rda")
#usethis::use_data(MIR_2022_dis_n_sites_per_strata,  overwrite = TRUE)
save(MIR_2022_ble_prev_species_region, file = "C:/Users/Sarah.Groves/Documents/R packages/NCRMP/ncrmp.benthics.analysis/data/MIR_2022_ble_prev_species_region.rda")
#usethis::use_data(MIR_2022_dis_ble_n_sites_per_region,  overwrite = TRUE)
```
##### Colony size
```{r}
tmp <- NCRMP_DRM_calculate_mean_colony_size(project = "MIR",
                                            region = "FLK",
                                            species_filter = "FALSE")
MIR_2022_col_size_species <- tmp$size_species
MIR_2022_col_size_site <- tmp$size_site
MIR_2022_col_size_cm2_strata <- tmp$size_est_cm2_strata
MIR_2022_col_size_cm3_strata <- tmp$size_est_cm3_strata
MIR_2022_col_size_region <- tmp$Domain_est
# Export data
write.csv(MIR_2022_col_size_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\MIR_2022_col_size_species.csv", row.names = F)
write.csv(MIR_2022_col_size_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\MIR_2022_col_size_site.csv", row.names = F)
write.csv(MIR_2022_col_size_cm2_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\MIR_2022_col_size_cm2_strata.csv", row.names = F)
write.csv(MIR_2022_col_size_cm3_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\MIR_2022_col_size_cm3_strata.csv", row.names = F)
write.csv(MIR_2022_col_size_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\MIR_2022_col_size_region.csv", row.names = F)
# copy to console and run
usethis::use_data(MIR_2022_col_size_species,  overwrite = TRUE)
usethis::use_data(MIR_2022_col_size_site,  overwrite = TRUE)
usethis::use_data(MIR_2022_col_size_cm2_strata,  overwrite = TRUE)
usethis::use_data(MIR_2022_col_size_cm3_strata,  overwrite = TRUE)
usethis::use_data(MIR_2022_col_size_region,  overwrite = TRUE)
```
##### Diadema density
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_calculate_invert_density(region = "FLK", project = "MIR")
MIR_2022_invert_den_site <- tmp$diadema_density_site
MIR_2022_invert_den_strata <- tmp$invert_strata # Right now just diadema
MIR_2022_invert_den_region <- tmp$Domain_est
# Export data 
write.csv(MIR_2022_invert_den_site, "K:\\_BioGeoProjects\\Data Analysis\\Analysis ready data\\Data Queries\\Invertebrates\\MIR_2022_invert_den_site.csv", row.names = F)
write.csv(MIR_2022_invert_den_strata, "K:\\_BioGeoProjects\\Data Analysis\\Analysis ready data\\Data Queries\\Invertebrates\\MIR_2022_invert_den_strata.csv", row.names = F)
write.csv(MIR_2022_invert_den_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\Invertebrates\\MIR_2022_invert_den_region.csv", row.names = F)
# copy to console and run
usethis::use_data(MIR_2022_invert_den_site,  overwrite = TRUE)
usethis::use_data(MIR_2022_invert_den_strata,  overwrite = TRUE)
usethis::use_data(MIR_2022_invert_den_region,  overwrite = TRUE)
# Don't forget to delete the previous years output in the R package and in the Data Queries folder 
```

###### Density t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_Tort_2014_22_density_region,
                    metric1 = 'density',
                    metric2 = 'avDen',
                    alpha = 0.05,
                    test_type = "Years",
                    n_years = 4, # this needs to be updated in conjunction with updating the t test function to accommodate more years
                    return_dataframe = FALSE)
```

###### Species
```{r}
# Run function and assign names to dataframes 
tmp <-NCRMP_colony_percent_cover(region = "Tortugas",
                                 ptitle = "The Dry Tortugas",
                                 file_path = "K:/_BioGeoProjects/NCRMP/Data Analysis/Analysis ready data/Figures" )
NCRMP_Tort_2014_22_percent_cover_region_species <- tmp$region_means
# Export data 
write.csv(NCRMP_Tort_2014_22_percent_cover_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_percent_cover_region_species.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_Tort_2014_22_percent_cover_region_species,  overwrite = TRUE)
```
##### Mortality - NCRMP only 
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_mortality(project = "NCRMP",
                                     region = "Tortugas",
                                     species_filter = "FALSE")
NCRMP_Tort_2014_22_old_mort_site <- tmp$old_mortality_site
NCRMP_Tort_2014_22_rec_mort_site <- tmp$recent_mortality_site
NCRMP_Tort_2014_22_old_mort_strata <- tmp$old_mortality_strata
NCRMP_Tort_2014_22_rec_mort_strata <- tmp$rec_mortality_strata
NCRMP_Tort_2014_22_old_mort_region <- tmp$Domain_est_old_mort
NCRMP_Tort_2014_22_rec_mort_region <- tmp$Domain_est_rec_mort
NCRMP_Tort_2014_22_old_mort_species_region <- tmp$Domain_est_old_mort_species
NCRMP_Tort_2014_22_rec_mort_species_region <- tmp$Domain_est_rec_mort_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_rec_mort_species$wh_sum)
unique(tmp$ntot_check_old_mort_species$wh_sum)
# Export data 
write.csv(NCRMP_Tort_2014_22_old_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_Tort_2014_22_old_mort_site.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_rec_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_Tort_2014_22_rec_mort_site.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_old_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_Tort_2014_22_old_mort_strata.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_rec_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_Tort_2014_22_rec_mort_strata.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_old_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_old_mort_region.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_rec_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_rec_mort_region.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_old_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_old_mort_species_region.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_rec_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_rec_mort_species_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_Tort_2014_22_rec_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_old_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_rec_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_old_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_rec_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_old_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_old_mort_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_rec_mort_species_region,  overwrite = TRUE)
# Don't forget to delete the previous years output in the R package and in the Data Queries folder 
```
##### DRM Mortality - NCRMP + DRM 
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_mortality(project = "NCRMP_DRM",
                                     region = "Tortugas",
                                     species_filter = "FALSE")
NCRMP_DRM_Tort_2014_22_old_mort_site <- tmp$old_mortality_site
NCRMP_DRM_Tort_2014_22_rec_mort_site <- tmp$recent_mortality_site
NCRMP_DRM_Tort_2014_22_old_mort_strata <- tmp$old_mortality_strata
NCRMP_DRM_Tort_2014_22_rec_mort_strata <- tmp$rec_mortality_strata
NCRMP_DRM_Tort_2014_22_old_mort_region <- tmp$Domain_est_old_mort
NCRMP_DRM_Tort_2014_22_rec_mort_region <- tmp$Domain_est_rec_mort
NCRMP_DRM_Tort_2014_22_old_mort_species_region <- tmp$Domain_est_old_mort_species
NCRMP_DRM_Tort_2014_22_rec_mort_species_region <- tmp$Domain_est_rec_mort_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_rec_mort_species$wh_sum)
unique(tmp$ntot_check_old_mort_species$wh_sum)
# Export data 
write.csv(NCRMP_DRM_Tort_2014_22_old_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_DRM_Tort_2014_22_old_mort_site.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_rec_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_DRM_Tort_2014_22_rec_mort_site.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_old_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_Tort_2014_22_old_mort_strata.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_rec_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_Tort_2014_22_rec_mort_strata.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_old_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_Tort_2014_22_old_mort_region.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_rec_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_Tort_2014_22_rec_mort_region.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_old_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_Tort_2014_22_old_mort_species_region.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_rec_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_Tort_2014_22_rec_mort_species_region.csv", row.names = F)
# must be copied to console to run
usethis::use_data(NCRMP_DRM_Tort_2014_22_rec_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_old_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_rec_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_old_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_rec_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_old_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_old_mort_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_rec_mort_species_region,  overwrite = TRUE)
# Don't forget to delete the previous years output in the R package and in the Data Queries folder 
```
##### Disease and bleaching - NCRMP only
```{r}
tmp <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = "NCRMP",
                                                       region = "Tortugas",
                                                       species_filter = "FALSE")
NCRMP_Tort_2014_22_dis_ble_prev_species <- tmp$dis_ble_prev_species
NCRMP_Tort_2014_22_dis_ble_prev_site <- tmp$dis_ble_prev_site
NCRMP_Tort_2014_22_dis_prev_strata <- tmp$dis_prev_strata
NCRMP_Tort_2014_22_ble_prev_strata <- tmp$ble_prev_strata
NCRMP_Tort_2014_22_dis_ble_prev_region <- tmp$Domain_est
# Export data
write.csv(NCRMP_Tort_2014_22_dis_ble_prev_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_Tort_2014_22_dis_ble_prev_species.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_dis_ble_prev_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_Tort_2014_22_dis_ble_prev_site.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_dis_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_Tort_2014_22_dis_prev_strata.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_ble_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_Tort_2014_22_ble_prev_strata.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_dis_ble_prev_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_dis_ble_prev_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_Tort_2014_22_dis_ble_prev_species,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_dis_ble_prev_site,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_dis_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_ble_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_dis_ble_prev_region,  overwrite = TRUE)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project="NCRMP",
                                                             region = "Tortugas")
NCRMP_Tort_2014_22_dis_prev_species_region <- tmp$DomainEst_dis
NCRMP_Tort_2014_22_ble_prev_species_region <- tmp$DomainEst_bl
# ntot check - wh_total should always be 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check$wh_total)
write.csv(NCRMP_Tort_2014_22_dis_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_dis_prev_species_region.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_ble_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_ble_prev_species_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_Tort_2014_22_dis_prev_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_ble_prev_species_region,  overwrite = TRUE)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_disease_prevalence_sites(project = "NCRMP",
                                                    region = "Tortugas",
                                                    species_filter = "FALSE")
NCRMP_Tort_2014_22_dis_ble_PA_site <- tmp$dis_ble_prev_site
NCRMP_Tort_2014_22_dis_n_sites_per_strata <- tmp$dis_ble_prev_strata
NCRMP_Tort_2014_22_dis_ble_n_sites_per_region <- tmp$disease_prev_region
write.csv(NCRMP_Tort_2014_22_dis_ble_PA_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_Tort_2014_22_dis_ble_PA_site.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_dis_n_sites_per_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_Tort_2014_22_dis_n_sites_per_strata.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_dis_ble_n_sites_per_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_dis_ble_n_sites_per_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_Tort_2014_22_dis_ble_PA_site,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_dis_n_sites_per_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_dis_ble_n_sites_per_region,  overwrite = TRUE)
```
##### DRM Disease prevalence - NCRMP + DRM 
```{r}
tmp <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = "NCRMP_DRM",
                                                       region = "Tortugas",
                                                       species_filter = "FALSE")
NCRMP_DRM_Tort_2014_22_dis_ble_prev_species <- tmp$dis_ble_prev_species
NCRMP_DRM_Tort_2014_22_dis_ble_prev_site <- tmp$dis_ble_prev_site
NCRMP_DRM_Tort_2014_22_dis_prev_strata <- tmp$dis_prev_strata
NCRMP_DRM_Tort_2014_22_ble_prev_strata <- tmp$ble_prev_strata
NCRMP_DRM_Tort_2014_22_dis_ble_prev_region <- tmp$Domain_est
# Export data
write.csv(NCRMP_DRM_Tort_2014_22_dis_ble_prev_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_DRM_Tort_2014_22_dis_ble_prev_species.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_dis_ble_prev_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_DRM_Tort_2014_22_dis_ble_prev_site.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_dis_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_Tort_2014_22_dis_prev_strata.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_ble_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_Tort_2014_22_ble_prev_strata.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_dis_ble_prev_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_Tort_2014_22_dis_ble_prev_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_DRM_Tort_2014_22_dis_ble_prev_species,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_dis_ble_prev_site,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_dis_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_ble_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_dis_ble_prev_region,  overwrite = TRUE)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project="NCRMP_DRM",
                                                             region = "Tortugas")
NCRMP_DRM_Tort_2014_22_dis_prev_species_region <- tmp$DomainEst_dis
NCRMP_DRM_Tort_2014_22_ble_prev_species_region <- tmp$DomainEst_bl
# ntot check - wh_total should always be 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check$wh_total)
write.csv(NCRMP_DRM_Tort_2014_22_dis_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_Tort_2014_22_dis_prev_species_region.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_ble_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_Tort_2014_22_ble_prev_species_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_DRM_Tort_2014_22_dis_prev_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_ble_prev_species_region,  overwrite = TRUE)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_disease_prevalence_sites(project = "NCRMP_DRM",
                                                    region = "Tortugas",
                                                    species_filter = "FALSE")
NCRMP_DRM_Tort_2014_22_dis_ble_PA_site <- tmp$dis_ble_prev_site
NCRMP_DRM_Tort_2014_22_dis_n_sites_per_strata <- tmp$dis_ble_prev_strata
NCRMP_DRM_Tort_2014_22_dis_ble_n_sites_per_region <- tmp$disease_prev_region
write.csv(NCRMP_DRM_Tort_2014_22_dis_ble_PA_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_DRM_Tort_2014_22_dis_ble_PA_site.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_dis_n_sites_per_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_DRM_Tort_2014_22_dis_n_sites_per_strata.csv", row.names = F)
write.csv(NCRMP_DRM_Tort_2014_22_dis_ble_n_sites_per_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_Tort_2014_22_dis_ble_n_sites_per_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_DRM_Tort_2014_22_dis_ble_PA_site,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_dis_n_sites_per_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_DRM_Tort_2014_22_dis_ble_n_sites_per_region,  overwrite = TRUE)
```
##### Colony size
```{r}
tmp <- NCRMP_DRM_calculate_mean_colony_size(project = "NCRMP",
                                            region = "Tortugas",
                                            species_filter = "FALSE")
NCRMP_Tort_2014_22_col_size_species <- tmp$size_species
NCRMP_Tort_2014_22_col_size_site <- tmp$size_site
NCRMP_Tort_2014_22_col_size_cm2_strata <- tmp$size_est_cm2_strata
NCRMP_Tort_2014_22_col_size_cm3_strata <- tmp$size_est_cm3_strata
NCRMP_Tort_2014_22_col_size_region <- tmp$Domain_est
NCRMP_Tort_2014_22_col_size_region_species <- tmp$Domain_est_species
# species-specific ntot check
unique(tmp$ntot_check_species$wh_sum)
# Export data
write.csv(NCRMP_Tort_2014_22_col_size_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_Tort_2014_22_col_size_species.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_col_size_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_Tort_2014_22_col_size_site.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_col_size_cm2_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_Tort_2014_22_col_size_cm2_strata.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_col_size_cm3_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_Tort_2014_22_col_size_cm3_strata.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_col_size_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_Tort_2014_22_col_size_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_Tort_2014_22_col_size_species,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_col_size_site,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_col_size_cm2_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_col_size_cm3_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_col_size_region,  overwrite = TRUE)
```
##### Colony size - NCRMP + DRM 
```{r}
tmp <- NCRMP_DRM_calculate_mean_colony_size(project = "NCRMP_DRM",
                                            region = "Tortugas",
                                            species_filter = "FALSE")
NCRMP_DRM_Tort_2014_22_col_size_region_species <- tmp$Domain_est_species
# species-specific ntot check
unique(tmp$ntot_check_species$wh_sum)
write.csv(NCRMP_DRM_Tort_2014_22_col_size_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_DRM_Tort_2014_22_col_size_region_species.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_DRM_Tort_2014_22_col_size_region_species,  overwrite = TRUE)
```
##### Diadema density
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_calculate_invert_density(region = "Tortugas", project = "NCRMP")
NCRMP_Tort_2014_22_invert_den_site <- tmp$diadema_density_site
NCRMP_Tort_2014_22_invert_den_strata <- tmp$invert_strata # Right now just diadema
NCRMP_Tort_2014_22_invert_den_region <- tmp$Domain_est # just diadema for now
# Export data 
write.csv(NCRMP_Tort_2014_22_invert_den_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_Tort_2014_22_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_invert_den_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_Tort_2014_22_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_Tort_2014_22_invert_den_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_Tort_2014_22_invert_den_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_Tort_2014_22_invert_den_site,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_invert_den_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_Tort_2014_22_invert_den_region,  overwrite = TRUE)
```
# GOM
##### Loading data exported from QAQC
```{r}
#Note I exported the data into an analysis ready data subfolder in the QAQC RMD folder I made for FGB, I then copied the files over to my local drive to then save in the analysis package
FGBNMS_2024_benthic_cover=read.csv("C:/Users/Lexie.Sturm/Documents/NCRMP Files/Data/analysisReadyData/AR_DATA_FGBNMS_2024/FGBNMS_2024_benthic_cover.csv")
FGBNMS_2024_coral_demographics=read.csv("C:/Users/Lexie.Sturm/Documents/NCRMP Files/Data/analysisReadyData/AR_DATA_FGBNMS_2024/FGBNMS_2024_coral_demographics.csv")
FGBNMS_2024_inverts_ESAcorals=read.csv("C:/Users/Lexie.Sturm/Documents/NCRMP Files/Data/analysisReadyData/AR_DATA_FGBNMS_2024/FGBNMS_2024_inverts_ESAcorals.csv")
FGBNMS_2024_NTOT= read.csv("C:/Users/Lexie.Sturm/Documents/NCRMP Files/Data/analysisReadyData/AR_DATA_FGBNMS_2024/FGBNMS_2024_NTOT.csv") %>%
#rename("STRAT" = "ANALYSIS_STRATUM")
rename(ANALYSIS_STRATUM = STRAT)
FGBNMS_2024_NTOT <- FGBNMS_2024_NTOT 
# save(FGBNMS_2024_benthic_cover, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/FGBNMS_2024_benthic_cover.rda")
# save(FGBNMS_2024_coral_demographics, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/FGBNMS_2024_coral_demographics.rda")
# save(FGBNMS_2024_inverts_ESAcorals, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/FGBNMS_2024_inverts_ESAcorals.rda")
# save(FGBNMS_2024_NTOT, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/FGBNMS_2024_NTOT.rda")
# These an be run in the console but not in the code chunk bc Rmd resets the wd after each chunk is run
usethis::use_data(FGBNMS_2024_benthic_cover,  overwrite = TRUE)
usethis::use_data(FGBNMS_2024_coral_demographics,  overwrite = TRUE)
usethis::use_data(FGBNMS_2024_inverts_ESAcorals,  overwrite = TRUE)
usethis::use_data(FGBNMS_2024_NTOT,  overwrite = TRUE)
```
##### Coral density

###### Density t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_FGBNMS_2013_24_density_region,
                    metric1 = 'density',
                    metric2 = 'avDen',
                    alpha = 0.05,
                    n_years = 4,
                    return_dataframe = FALSE)
```

###### Species
```{r}
# Run function and assign names to dataframes. NCRMP_FGBNMS_2013_24_percent_cover_species created above needs to be added to the package before this function can run.
tmp <-NCRMP_colony_percent_cover(region = "GOM",
                                 ptitle = "Flower Garden Banks",
                                 file_path = "K:/_BioGeoProjects/NCRMP/Data Analysis/Analysis ready data/Figures" )
NCRMP_FGBNMS_2013_24_percent_cover_region_species <- tmp$region_means
# Export data 
write.csv(NCRMP_FGBNMS_2013_24_percent_cover_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_percent_cover_region_species.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FGBNMS_2013_24_percent_cover_region_species,  overwrite = TRUE)
```
###### Percent cover t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_FGBNMS_2013_24_cover_region,
                    metric1 = 'coral_cover',
                    metric2 = 'avCvr',
                    #test_type = "Years",
                    alpha = 0.05,
                    n_years = 5,
                    return_dataframe = FALSE)
NCRMP_perform_ttest(dataframe = NCRMP_FGBNMS_2013_24_cover_region,
                    metric1 = 'macroalgae_cover',
                    metric2 = 'avCvr',
                    #test_type = "Years",
                    alpha = 0.05,
                    n_years = 5,
                    return_dataframe = FALSE)
```
##### Mortality
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_mortality(project = "NCRMP",
                                     region = "GOM",
                                     species_filter = "FALSE")
NCRMP_FGBNMS_2013_24_old_mort_site <- tmp$old_mortality_site
NCRMP_FGBNMS_2013_24_rec_mort_site <- tmp$recent_mortality_site
NCRMP_FGBNMS_2013_24_old_mort_strata <- tmp$old_mortality_strata
NCRMP_FGBNMS_2013_24_rec_mort_strata <- tmp$rec_mortality_strata
NCRMP_FGBNMS_2013_24_old_mort_region <- tmp$Domain_est_old_mort
NCRMP_FGBNMS_2013_24_rec_mort_region <- tmp$Domain_est_rec_mort
NCRMP_FGBNMS_2013_24_old_mort_species_region <- tmp$Domain_est_old_mort_species
NCRMP_FGBNMS_2013_24_rec_mort_species_region <- tmp$Domain_est_rec_mort_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_rec_mort_species$wh_sum)
unique(tmp$ntot_check_old_mort_species$wh_sum)
# Export data 
write.csv(NCRMP_FGBNMS_2013_24_old_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FGBNMS_2013_24_old_mort_site.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_rec_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FGBNMS_2013_24_rec_mort_site.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_old_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FGBNMS_2013_24_old_mort_strata.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_rec_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FGBNMS_2013_24_rec_mort_strata.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_old_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_old_mort_region.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_rec_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_rec_mort_region.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_old_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_old_mort_species_region.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_rec_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_rec_mort_species_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FGBNMS_2013_24_rec_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_old_mort_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_rec_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_old_mort_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_rec_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_old_mort_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_old_mort_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_rec_mort_species_region,  overwrite = TRUE)
# remove old data objects
```
###### Mortality t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_FGBNMS_2013_24_old_mort_region,
                    metric1 = "old_mortality",
                    metric2 = 'avMort',
                    alpha = 0.05,
                    n_years = 5,
                    return_dataframe = FALSE)
NCRMP_perform_ttest(dataframe = NCRMP_FGBNMS_2013_24_rec_mort_region,
                    metric1 = "recent_mortality",
                    metric2 = 'avMort',
                    alpha = 0.05,
                    n_years = 5,
                    return_dataframe = FALSE)
```
##### Disease and bleaching 
```{r}
tmp <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = "NCRMP",
                                                       region = "GOM",
                                                       species_filter = "FALSE")
NCRMP_FGBNMS_2013_24_dis_ble_prev_species <- tmp$dis_ble_prev_species
NCRMP_FGBNMS_2013_24_dis_ble_prev_site <- tmp$dis_ble_prev_site
NCRMP_FGBNMS_2013_24_dis_prev_strata <- tmp$dis_prev_strata
NCRMP_FGBNMS_2013_24_ble_prev_strata <- tmp$ble_prev_strata
NCRMP_FGBNMS_2013_24_dis_ble_prev_region <- tmp$Domain_est
# Export data
write.csv(NCRMP_FGBNMS_2013_24_dis_ble_prev_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FGBNMS_2013_24_dis_ble_prev_species.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_dis_ble_prev_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FGBNMS_2013_24_dis_ble_prev_site.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_dis_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FGBNMS_2013_24_dis_prev_strata.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_ble_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FGBNMS_2013_24_ble_prev_strata.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_dis_ble_prev_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_dis_ble_prev_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FGBNMS_2013_24_dis_ble_prev_species,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_dis_ble_prev_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_dis_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_ble_prev_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_dis_ble_prev_region,  overwrite = TRUE)
###################
  
  #NCRMP_FGBNMS_2013_24_dis_ble_prev_species created above needs to be added to the package before this function can run.
  
tmp <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project="NCRMP",
                                                               region = "GOM")
NCRMP_FGBNMS_2013_24_dis_prev_species_region <- tmp$DomainEst_dis
NCRMP_FGBNMS_2013_24_ble_prev_species_region <- tmp$DomainEst_bl
# ntot check - wh_total should always be 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check$wh_total)
write.csv(NCRMP_FGBNMS_2013_24_dis_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_dis_prev_species_region.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_ble_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_ble_prev_species_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FGBNMS_2013_24_dis_prev_species_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_ble_prev_species_region,  overwrite = TRUE)
#####################
  
tmp <- NCRMP_DRM_calculate_disease_prevalence_sites(project = "NCRMP",
                                                      region = "GOM",
                                                      species_filter = "FALSE")
NCRMP_FGBNMS_2013_24_dis_ble_PA_site <- tmp$dis_ble_prev_site
NCRMP_FGBNMS_2013_24_dis_n_sites_per_strata <- tmp$dis_ble_prev_strata
NCRMP_FGBNMS_2013_24_dis_ble_n_sites_per_region <- tmp$disease_prev_region
write.csv(NCRMP_FGBNMS_2013_24_dis_ble_PA_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FGBNMS_2013_24_dis_ble_PA_site.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_dis_n_sites_per_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FGBNMS_2013_24_dis_n_sites_per_strata.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_dis_ble_n_sites_per_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_dis_ble_n_sites_per_region.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FGBNMS_2013_24_dis_ble_PA_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_dis_n_sites_per_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_dis_ble_n_sites_per_region,  overwrite = TRUE)
```
##### Colony size
```{r}
tmp <- NCRMP_DRM_calculate_mean_colony_size(project = "NCRMP",
                                            region = "GOM",
                                            species_filter = "FALSE")
NCRMP_FGBNMS_2013_24_col_size_species <- tmp$size_species
NCRMP_FGBNMS_2013_24_col_size_site <- tmp$size_site
NCRMP_FGBNMS_2013_24_col_size_cm2_strata <- tmp$size_est_cm2_strata
NCRMP_FGBNMS_2013_24_col_size_cm3_strata <- tmp$size_est_cm3_strata
NCRMP_FGBNMS_2013_24_col_size_region <- tmp$Domain_est
NCRMP_FGBNMS_2013_24_col_size_region_species <- tmp$Domain_est_species
# species-specific ntot check
unique(tmp$ntot_check_species$wh_sum)
# Export data
write.csv(NCRMP_FGBNMS_2013_24_col_size_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FGBNMS_2013_24_col_size_species.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_col_size_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_FGBNMS_2013_24_col_size_site.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_col_size_cm2_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FGBNMS_2013_24_col_size_cm2_strata.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_col_size_cm3_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_FGBNMS_2013_24_col_size_cm3_strata.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_col_size_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_col_size_region.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_col_size_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_FGBNMS_2013_24_col_size_region_species.csv", row.names = F)
# copy to console and run
usethis::use_data(NCRMP_FGBNMS_2013_24_col_size_species,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_col_size_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_col_size_cm2_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_col_size_cm3_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_col_size_region,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_col_size_region_species,  overwrite = TRUE)
```
###### Colony size t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_FGBNMS_2013_24_col_size_region,
                    metric1 = 'colony_size',
                    metric2 = 'avCm3',
                    alpha = 0.05,
                    n_years = 5,
                    return_dataframe = FALSE)
```
##### Diadema density
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_calculate_invert_density(region = "GOM")
NCRMP_FGBNMS_2013_24_invert_den_site <- tmp$diadema_density_site
NCRMP_FGBNMS_2013_24_invert_den_strata <- tmp$invert_strata # Right now just diadema
NCRMP_FGBNMS_2013_24_invert_den_region <- tmp$Domain_est
# Export data 
write.csv(NCRMP_FGBNMS_2013_24_invert_den_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_FGBNMS_2013_24_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_invert_den_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_FGBNMS_2013_24_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_FGBNMS_2013_24_invert_den_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_FGBNMS_2013_24_invert_den_region.csv", row.names = F)
usethis::use_data(NCRMP_FGBNMS_2013_24_invert_den_site,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_invert_den_strata,  overwrite = TRUE)
usethis::use_data(NCRMP_FGBNMS_2013_24_invert_den_region,  overwrite = TRUE)
```

###### Density t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_STTSTJ_2013_23_density_region,
                    metric1 = 'density',
                    metric2 = 'avDen',
                    alpha = 0.05,
                    n_years = 5,
                    test_type = "Years",
                    return_dataframe = FALSE)
```

###### Species
```{r}
# Run function and assign names to dataframes 
tmp <-NCRMP_colony_percent_cover(region = "STTSTJ",
                                 ptitle = "St. Thomas & St. John",
                                 file_path = "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Figures" )
NCRMP_STTSTJ_2013_23_percent_cover_region_species <- tmp$region_means
# Export data 
write.csv(NCRMP_STTSTJ_2013_23_percent_cover_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_percent_cover_region_species.csv", row.names = F)
#usethis::use_data(NCRMP_STTSTJ_2013_21_percent_cover_region_species,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_percent_cover_region_species, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_percent_cover_region_species.rda")
```
###### Percent cover t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_STTSTJ_2013_23_cover_region,
                    metric1 = 'coral_cover',
                    metric2 = 'avCvr',
                    alpha = 0.05,
                    n_years = 6,
                    #test_type = "Years",
                    return_dataframe = FALSE)
NCRMP_perform_ttest(dataframe = NCRMP_STTSTJ_2013_23_cover_region,
                    metric1 = 'macroalgae_cover',
                    metric2 = 'avCvr',
                    alpha = 0.05,
                    n_years = 6,
                    #test_type = "Years",
                    return_dataframe = FALSE)
```
##### Mortality
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_mortality(project = "NCRMP",
                                     region = "STTSTJ",
                                     species_filter = "FALSE")
NCRMP_STTSTJ_2013_23_old_mort_site <- tmp$old_mortality_site
NCRMP_STTSTJ_2013_23_rec_mort_site <- tmp$recent_mortality_site
NCRMP_STTSTJ_2013_23_old_mort_strata <- tmp$old_mortality_strata
NCRMP_STTSTJ_2013_23_rec_mort_strata <- tmp$rec_mortality_strata
NCRMP_STTSTJ_2013_23_old_mort_region <- tmp$Domain_est_old_mort
NCRMP_STTSTJ_2013_23_rec_mort_region <- tmp$Domain_est_rec_mort
NCRMP_STTSTJ_2013_23_old_mort_species_region <- tmp$Domain_est_old_mort_species
NCRMP_STTSTJ_2013_23_rec_mort_species_region <- tmp$Domain_est_rec_mort_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_rec_mort_species$wh_sum)
unique(tmp$ntot_check_old_mort_species$wh_sum)
# Export data 
write.csv(NCRMP_STTSTJ_2013_23_old_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STTSTJ_2013_23_old_mort_site.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_rec_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STTSTJ_2013_23_rec_mort_site.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_old_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STTSTJ_2013_23_old_mort_strata.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_rec_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STTSTJ_2013_23_rec_mort_strata.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_old_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_old_mort_region.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_rec_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_rec_mort_region.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_old_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_old_mort_species_region.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_rec_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_rec_mort_species_region.csv", row.names = F)
#usethis::use_data(NCRMP_STTSTJ_2013_21_rec_mort_site,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_rec_mort_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_rec_mort_site.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_old_mort_site,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_old_mort_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_old_mort_site.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_rec_mort_strata,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_rec_mort_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_rec_mort_strata.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_old_mort_strata,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_old_mort_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_old_mort_strata.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_rec_mort_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_rec_mort_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_rec_mort_region.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_old_mort_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_old_mort_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_old_mort_region.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_rec_mort_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_rec_mort_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_rec_mort_species_region.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_old_mort_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_old_mort_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_old_mort_species_region.rda")
```
###### Mortality t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_STTSTJ_2013_23_old_mort_region,
                    metric1 = "old_mortality",
                    metric2 = 'avMort',
                    alpha = 0.05,
                    n_years = 6,
                    #test_type = "Years",
                    return_dataframe = FALSE)
NCRMP_perform_ttest(dataframe = NCRMP_STTSTJ_2013_23_rec_mort_region,
                    metric1 = "recent_mortality",
                    metric2 = 'avMort',
                    alpha = 0.05,
                    n_years = 6,
                    #test_type = "Years",
                    return_dataframe = FALSE)
```
##### Disease and bleaching 
```{r}
tmp <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = "NCRMP",
                                                       region = "STTSTJ",
                                                       species_filter = "FALSE")
NCRMP_STTSTJ_2013_23_dis_ble_prev_species <- tmp$dis_ble_prev_species
NCRMP_STTSTJ_2013_23_dis_ble_prev_site <- tmp$dis_ble_prev_site
NCRMP_STTSTJ_2013_23_dis_prev_strata <- tmp$dis_prev_strata
NCRMP_STTSTJ_2013_23_ble_prev_strata <- tmp$ble_prev_strata
NCRMP_STTSTJ_2013_23_dis_ble_prev_region <- tmp$Domain_est
# Export data
write.csv(NCRMP_STTSTJ_2013_23_dis_ble_prev_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Species level metrics\\NCRMP_STTSTJ_2013_23_dis_ble_prev_species.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_dis_ble_prev_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STTSTJ_2013_23_dis_ble_prev_site.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_dis_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STTSTJ_2013_23_dis_prev_strata.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_ble_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STTSTJ_2013_23_ble_prev_strata.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_dis_ble_prev_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_dis_ble_prev_region.csv", row.names = F)
#usethis::use_data(NCRMP_STTSTJ_2013_21_dis_ble_prev_species,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_dis_ble_prev_species, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_dis_ble_prev_species.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_dis_ble_prev_site,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_dis_ble_prev_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_dis_ble_prev_site.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_dis_prev_strata,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_dis_prev_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_dis_prev_strata.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_ble_prev_strata,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_ble_prev_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_ble_prev_strata.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_dis_ble_prev_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_dis_ble_prev_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_dis_ble_prev_region.rda")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project="NCRMP",
                                                             region = "STTSTJ")
NCRMP_STTSTJ_2013_23_dis_prev_species_region <- tmp$DomainEst_dis
NCRMP_STTSTJ_2013_23_ble_prev_species_region <- tmp$DomainEst_bl
# ntot check - wh_total should always be 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check$wh_total)
write.csv(NCRMP_STTSTJ_2013_23_dis_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_dis_prev_species_region.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_ble_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_ble_prev_species_region.csv", row.names = F)
#usethis::use_data(NCRMP_STTSTJ_2013_21_dis_prev_species_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_dis_prev_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_dis_prev_species_region.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_ble_prev_species_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_ble_prev_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_ble_prev_species_region.rda")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_disease_prevalence_sites(project = "NCRMP",
                                                    region = "STTSTJ",
                                                    species_filter = "FALSE")
NCRMP_STTSTJ_2013_23_dis_ble_PA_site <- tmp$dis_ble_prev_site
NCRMP_STTSTJ_2013_23_dis_n_sites_per_strata <- tmp$dis_ble_prev_strata
NCRMP_STTSTJ_2013_23_dis_ble_n_sites_per_region <- tmp$disease_prev_region
write.csv(NCRMP_STTSTJ_2013_23_dis_ble_PA_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STTSTJ_2013_23_dis_ble_PA_site.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_dis_n_sites_per_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STTSTJ_2013_23_dis_n_sites_per_strata.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_dis_ble_n_sites_per_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_dis_ble_n_sites_per_region.csv", row.names = F)
#usethis::use_data(NCRMP_STTSTJ_2013_21_dis_ble_PA_site,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_dis_ble_PA_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_dis_ble_PA_site.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_dis_n_sites_per_strata,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_dis_n_sites_per_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_dis_n_sites_per_strata.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_dis_ble_n_sites_per_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_dis_ble_n_sites_per_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_dis_ble_n_sites_per_region.rda")
```
##### Colony size
```{r}
tmp <- NCRMP_DRM_calculate_mean_colony_size(project = "NCRMP",
                                            region = "STTSTJ",
                                            species_filter = "FALSE")
NCRMP_STTSTJ_2013_23_col_size_species <- tmp$size_species
NCRMP_STTSTJ_2013_23_col_size_site <- tmp$size_site
NCRMP_STTSTJ_2013_23_col_size_cm2_strata <- tmp$size_est_cm2_strata
NCRMP_STTSTJ_2013_23_col_size_cm3_strata <- tmp$size_est_cm3_strata
NCRMP_STTSTJ_2013_23_col_size_region <- tmp$Domain_est
NCRMP_STTSTJ_2013_23_col_size_region_species <- tmp$Domain_est_species
# Export data
write.csv(NCRMP_STTSTJ_2013_23_col_size_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Species level metrics\\NCRMP_STTSTJ_2013_23_col_size_species.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_col_size_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STTSTJ_2013_23_col_size_site.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_col_size_cm2_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STTSTJ_2013_23_col_size_cm2_strata.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_col_size_cm3_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STTSTJ_2013_23_col_size_cm3_strata.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_col_size_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_col_size_region.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_col_size_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STTSTJ_2013_23_col_size_region.csv", row.names = F)
#usethis::use_data(NCRMP_STTSTJ_2013_21_col_size_species,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_col_size_species, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_col_size_species.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_col_size_site,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_col_size_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_col_size_site.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_col_size_cm2_strata,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_col_size_cm2_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_col_size_cm2_strata.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_col_size_cm3_strata,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_col_size_cm3_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_col_size_cm3_strata.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_col_size_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_col_size_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_col_size_region.rda")
save(NCRMP_STTSTJ_2013_23_col_size_region_species, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_col_size_region_species.rda")
```
###### Colony size t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_STTSTJ_2013_23_col_size_region,
                    metric1 = 'colony_size',
                    metric2 = 'avCm3',
                    alpha = 0.05,
                    n_years = 6,
                   #test_type = "Years",
                    return_dataframe = FALSE)
```
##### Diadema density
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_calculate_invert_density(region = "STTSTJ")
NCRMP_STTSTJ_2013_23_invert_den_site <- tmp$diadema_density_site
NCRMP_STTSTJ_2013_23_invert_den_strata <- tmp$invert_strata # Right now just diadema
NCRMP_STTSTJ_2013_23_invert_den_region <- tmp$Domain_est
# Export data 
write.csv(NCRMP_STTSTJ_2013_23_invert_den_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_STTSTJ_2013_23_invert_den_site.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_invert_den_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_STTSTJ_2013_23_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_STTSTJ_2013_23_invert_den_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_STTSTJ_2013_23_invert_den_region.csv", row.names = F)
#usethis::use_data(NCRMP_STTSTJ_2013_21_invert_den_site,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_invert_den_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_invert_den_site.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_invert_den_strata,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_invert_den_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_invert_den_strata.rda")
#usethis::use_data(NCRMP_STTSTJ_2013_21_invert_den_region,  overwrite = TRUE)
save(NCRMP_STTSTJ_2013_23_invert_den_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STTSTJ_2013_23_invert_den_region.rda")
```
### St. Croix  
###### Density t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_STX_2015_23_density_region,
                    metric1 = 'density',
                    metric2 = 'avDen',
                    alpha = 0.05,
                    n_years = 5,
                    test_type = "Years",
                    return_dataframe = FALSE)
```

###### Species
```{r}
# Run function and assign names to dataframes 
tmp <-NCRMP_colony_percent_cover(region = "STX",
                                 ptitle = "St. Croix",
                                 file_path = "K:/_BioGeoProjects/NCRMP/Data Analysis/Analysis ready data/Figures" )
NCRMP_STX_2015_23_percent_cover_region_species <- tmp$region_means
# Export data 
write.csv(NCRMP_STX_2015_23_percent_cover_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_percent_cover_region_species.csv", row.names = F)
#usethis::use_data(NCRMP_STX_2015_21_percent_cover_region_species,  overwrite = TRUE)
save(NCRMP_STX_2015_23_percent_cover_region_species, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_percent_cover_region_species.rda")
```
###### Percent cover t-test 
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_STX_2015_23_cover_region,
                    metric1 = 'coral_cover',
                    metric2 = 'avCvr',
                    alpha = 0.05,
                    n_years = 5,
                    #test_type = "Years",
                    return_dataframe = FALSE)
NCRMP_perform_ttest(dataframe = NCRMP_STX_2015_23_cover_region,
                    metric1 = 'macroalgae_cover',
                    metric2 = 'avCvr',
                    alpha = 0.05,
                    n_years = 5,
                    #test_type = "Years",
                    return_dataframe = FALSE)
```
##### Mortality
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_mortality(project = "NCRMP",
                                     region = "STX",
                                     species_filter = "FALSE")
NCRMP_STX_2015_23_old_mort_site <- tmp$old_mortality_site
NCRMP_STX_2015_23_rec_mort_site <- tmp$recent_mortality_site
NCRMP_STX_2015_23_old_mort_strata <- tmp$old_mortality_strata
NCRMP_STX_2015_23_rec_mort_strata <- tmp$rec_mortality_strata
NCRMP_STX_2015_23_old_mort_region <- tmp$Domain_est_old_mort
NCRMP_STX_2015_23_rec_mort_region <- tmp$Domain_est_rec_mort
NCRMP_STX_2015_23_old_mort_species_region <- tmp$Domain_est_old_mort_species
NCRMP_STX_2015_23_rec_mort_species_region <- tmp$Domain_est_rec_mort_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_rec_mort_species$wh_sum)
unique(tmp$ntot_check_old_mort_species$wh_sum)
# Export data 
write.csv(NCRMP_STX_2015_23_old_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STX_2015_23_old_mort_site.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_rec_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STX_2015_23_rec_mort_site.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_old_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STX_2015_23_old_mort_strata.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_rec_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STX_2015_23_rec_mort_strata.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_old_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_old_mort_region.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_rec_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_rec_mort_region.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_old_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_old_mort_species_region.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_rec_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_rec_mort_species_regioncsv", row.names = F)
#usethis::use_data(NCRMP_STX_2015_21_rec_mort_site,  overwrite = TRUE)
save(NCRMP_STX_2015_23_rec_mort_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_rec_mort_site.rda")
# copy to console to run
usethis::use_data(NCRMP_STX_2015_23_rec_mort_site,  overwrite = TRUE)
#usethis::use_data(NCRMP_STX_2015_23_old_mort_site,  overwrite = TRUE)
save(NCRMP_STX_2015_23_old_mort_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_old_mort_site.rda")
#usethis::use_data(NCRMP_STX_2015_21_rec_mort_strata,  overwrite = TRUE)
save(NCRMP_STX_2015_23_rec_mort_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_rec_mort_strata.rda")
#usethis::use_data(NCRMP_STX_2015_21_old_mort_strata,  overwrite = TRUE)
save(NCRMP_STX_2015_23_old_mort_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_old_mort_strata.rda")
#usethis::use_data(NCRMP_STX_2015_21_rec_mort_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_rec_mort_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_rec_mort_region.rda")
#usethis::use_data(NCRMP_STX_2015_21_old_mort_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_old_mort_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_old_mort_region.rda")
#usethis::use_data(NCRMP_STX_2015_23_old_mort_species_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_old_mort_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_old_mort_species_region.rda")
#usethis::use_data(NCRMP_STX_2015_21_rec_mort_species_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_rec_mort_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_rec_mort_species_region.rda")
```
###### Mortality t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_STX_2015_23_old_mort_region,
                    metric1 = "old_mortality",
                    metric2 = 'avMort',
                    alpha = 0.05,
                    n_years = 5,
                    #test_type = "Years",
                    return_dataframe = FALSE)
NCRMP_perform_ttest(dataframe = NCRMP_STX_2015_23_rec_mort_region,
                    metric1 = "recent_mortality",
                    metric2 = 'avMort',
                    alpha = 0.05,
                    n_years = 5,
                    #test_type = "Years",
                    return_dataframe = FALSE)
```
##### Disease and bleaching
```{r}
tmp <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = "NCRMP",
                                                       region = "STX",
                                                       species_filter = "FALSE")
NCRMP_STX_2015_23_dis_ble_prev_species <- tmp$dis_ble_prev_species
NCRMP_STX_2015_23_dis_ble_prev_site <- tmp$dis_ble_prev_site
NCRMP_STX_2015_23_dis_prev_strata <- tmp$dis_prev_strata
NCRMP_STX_2015_23_ble_prev_strata <- tmp$ble_prev_strata
NCRMP_STX_2015_23_dis_ble_prev_region <- tmp$Domain_est
# Export data
write.csv(NCRMP_STX_2015_23_dis_ble_prev_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Species level metrics\\NCRMP_STX_2015_23_dis_ble_prev_species.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_dis_ble_prev_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STX_2015_23_dis_ble_prev_site.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_dis_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STX_2015_23_dis_prev_strata.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_ble_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STX_2015_23_ble_prev_strata.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_dis_ble_prev_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_dis_ble_prev_region.csv", row.names = F)
#usethis::use_data(NCRMP_STTSTJ_2013_21_dis_ble_prev_species,  overwrite = TRUE)
save(NCRMP_STX_2015_23_dis_ble_prev_species, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_dis_ble_prev_species.rda")
#usethis::use_data(NCRMP_STX_2015_21_dis_ble_prev_site,  overwrite = TRUE)
save(NCRMP_STX_2015_23_dis_ble_prev_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_dis_ble_prev_site.rda")
#usethis::use_data(NCRMP_STX_2015_21_dis_prev_strata,  overwrite = TRUE)
save(NCRMP_STX_2015_23_dis_prev_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_dis_prev_strata.rda")
#usethis::use_data(NCRMP_STX_2015_21_ble_prev_strata,  overwrite = TRUE)
save(NCRMP_STX_2015_23_ble_prev_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_ble_prev_strata.rda")
#usethis::use_data(NCRMP_STX_2015_21_dis_ble_prev_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_dis_ble_prev_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_dis_ble_prev_region.rda")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project="NCRMP",
                                                             region = "STX")
NCRMP_STX_2015_23_dis_prev_species_region <- tmp$DomainEst_dis
NCRMP_STX_2015_23_ble_prev_species_region <- tmp$DomainEst_bl
# ntot check - wh_total should always be 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check$wh_total)
write.csv(NCRMP_STX_2015_23_dis_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_dis_prev_species_region.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_ble_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_ble_prev_species_region.csv", row.names = F)
#usethis::use_data(NCRMP_STX_2015_21_dis_prev_species_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_dis_prev_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_dis_prev_species_region.rda")
#usethis::use_data(NCRMP_STX_2015_21_ble_prev_species_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_ble_prev_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_ble_prev_species_region.rda")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_disease_prevalence_sites(project = "NCRMP",
                                                    region = "STX",
                                                    species_filter = "FALSE")
NCRMP_STX_2015_23_dis_ble_PA_site <- tmp$dis_ble_prev_site
NCRMP_STX_2015_23_dis_n_sites_per_strata <- tmp$dis_ble_prev_strata
NCRMP_STX_2015_23_dis_ble_n_sites_per_region <- tmp$disease_prev_region
write.csv(NCRMP_STX_2015_23_dis_ble_PA_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STX_2015_23_dis_ble_PA_site.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_dis_n_sites_per_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STX_2015_23_dis_n_sites_per_strata.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_dis_ble_n_sites_per_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_dis_ble_n_sites_per_region.csv", row.names = F)
#usethis::use_data(NCRMP_STX_2015_21_dis_ble_PA_site,  overwrite = TRUE)
save(NCRMP_STX_2015_23_dis_ble_PA_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_dis_ble_PA_site.rda")
#usethis::use_data(NCRMP_STX_2015_21_dis_n_sites_per_strata,  overwrite = TRUE)
save(NCRMP_STX_2015_23_dis_n_sites_per_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_dis_n_sites_per_strata.rda")
#usethis::use_data(NCRMP_STX_2015_21_dis_ble_n_sites_per_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_dis_ble_n_sites_per_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_dis_ble_n_sites_per_region.rda")
# remove old versions
```
##### Colony size
```{r}
tmp <- NCRMP_DRM_calculate_mean_colony_size(project = "NCRMP",
                                            region = "STX",
                                            species_filter = "FALSE")
NCRMP_STX_2015_23_col_size_species <- tmp$size_species
NCRMP_STX_2015_23_col_size_site <- tmp$size_site
NCRMP_STX_2015_23_col_size_cm2_strata <- tmp$size_est_cm2_strata
NCRMP_STX_2015_23_col_size_cm3_strata <- tmp$size_est_cm3_strata
NCRMP_STX_2015_23_col_size_region <- tmp$Domain_est
NCRMP_STX_2015_23_col_size_region_species <- tmp$Domain_est_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_species$wh_sum)
# Export data
write.csv(NCRMP_STX_2015_23_col_size_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STX_2015_23_col_size_species.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_col_size_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_STX_2015_23_col_size_site.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_col_size_cm2_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STX_2015_23_col_size_cm2_strata.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_col_size_cm3_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_STX_2015_23_col_size_cm3_strata.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_col_size_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_23_col_size_region.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_col_size_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_STX_2015_21_col_size_region_species.csv", row.names = F)
#usethis::use_data(NCRMP_STX_2015_21_col_size_species,  overwrite = TRUE)
save(NCRMP_STX_2015_23_col_size_species, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_col_size_species.rda")
#usethis::use_data(NCRMP_STX_2015_21_col_size_site,  overwrite = TRUE)
save(NCRMP_STX_2015_23_col_size_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_col_size_site.rda")
#usethis::use_data(NCRMP_STX_2015_21_col_size_cm2_strata,  overwrite = TRUE)
save(NCRMP_STX_2015_23_col_size_cm2_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_col_size_cm2_strata.rda")
#usethis::use_data(NCRMP_STX_2015_21_col_size_cm3_strata,  overwrite = TRUE)
save(NCRMP_STX_2015_23_col_size_cm3_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_col_size_cm3_strata.rda")
#usethis::use_data(NCRMP_STX_2015_21_col_size_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_col_size_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_col_size_region.rda")
save(NCRMP_STX_2015_23_col_size_region_species, file = "C:/Users/Lexie.Sturm/Documents/NCRMP_STX_2015_23_col_size_region_species.rda")
```
###### Colony size t-test
```{r}
#Not working for some reason need to double check
NCRMP_perform_ttest(dataframe = NCRMP_STX_2015_23_col_size_region,
                    metric1 = 'colony_size',
                    metric2 = 'avCm3',
                    alpha = 0.05,
                    n_years = 5,
                    #test_type = "Years",
                    return_dataframe = FALSE)
```
##### Diadema density
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_calculate_invert_density(region = "STX")
NCRMP_STX_2015_23_invert_den_site <- tmp$diadema_density_site
NCRMP_STX_2015_23_invert_den_strata <- tmp$invert_strata # Right now just diadema
NCRMP_STX_2015_23_invert_den_region <- tmp$Domain_est
# Export data 
write.csv(NCRMP_STX_2015_23_invert_den_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_STX_2015_23_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_invert_den_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_STX_2015_23_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_STX_2015_23_invert_den_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_STX_2015_23_invert_den_region.csv", row.names = F)
#usethis::use_data(NCRMP_STX_2015_21_invert_den_site,  overwrite = TRUE)
save(NCRMP_STX_2015_23_invert_den_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_invert_den_site.rda")
#usethis::use_data(NCRMP_STX_2015_21_invert_den_strata,  overwrite = TRUE)
save(NCRMP_STX_2015_23_invert_den_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_invert_den_strata.rda")
#usethis::use_data(NCRMP_STX_2015_21_invert_den_region,  overwrite = TRUE)
save(NCRMP_STX_2015_23_invert_den_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_STX_2015_23_invert_den_region.rda")
# remove old versions
```

###### Density t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_PRICO_2014_23_density_region,
                    metric1 = 'density',
                    metric2 = 'avDen',
                    alpha = 0.05,
                    n_years = 5,
                    #test_type = "Years",
                    return_dataframe = FALSE)
```

###### Species
```{r}
# Run function and assign names to dataframes 
tmp <-NCRMP_colony_percent_cover(region = "PRICO",
                                 ptitle = "Puerto Rico",
                                 file_path = "K:/_BioGeoProjects/NCRMP/Data Analysis/Analysis ready data/Figures" )
NCRMP_PRICO_2014_23_percent_cover_region_species <- tmp$region_means
# Export data 
write.csv(NCRMP_PRICO_2014_23_percent_cover_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_percent_cover_region_species.csv", row.names = F)
#usethis::use_data(NCRMP_PRICO_2014_21_percent_cover_region_species,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_percent_cover_region_species, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_percent_cover_region_species.rda")
```
###### Percent cover t-test 
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_PRICO_2014_23_cover_region,
                    metric1 = 'coral_cover',
                    metric2 = 'avCvr',
                    alpha = 0.05,
                    n_years = 5,
                    test_type = "Years",
                    return_dataframe = FALSE)
NCRMP_perform_ttest(dataframe = NCRMP_PRICO_2014_23_cover_region,
                    metric1 = 'macroalgae_cover',
                    metric2 = 'avCvr',
                    alpha = 0.05,
                    n_years = 5,
                    test_type = "Years",
                    return_dataframe = FALSE)
```
##### Mortality
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_DRM_calculate_mortality(project = "NCRMP",
                                     region = "PRICO",
                                     species_filter = "FALSE")
NCRMP_PRICO_2014_23_old_mort_site <- tmp$old_mortality_site
NCRMP_PRICO_2014_23_rec_mort_site <- tmp$recent_mortality_site
NCRMP_PRICO_2014_23_old_mort_strata <- tmp$old_mortality_strata
NCRMP_PRICO_2014_23_rec_mort_strata <- tmp$rec_mortality_strata
NCRMP_PRICO_2014_23_old_mort_region <- tmp$Domain_est_old_mort
NCRMP_PRICO_2014_23_rec_mort_region <- tmp$Domain_est_rec_mort
NCRMP_PRICO_2014_23_old_mort_species_region <- tmp$Domain_est_old_mort_species
NCRMP_PRICO_2014_23_rec_mort_species_region <- tmp$Domain_est_rec_mort_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_rec_mort_species$wh_sum)
unique(tmp$ntot_check_old_mort_species$wh_sum)
# Export data 
write.csv(NCRMP_PRICO_2014_23_old_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_PRICO_2014_23_old_mort_site.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_rec_mort_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_PRICO_2014_23_rec_mort_site.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_old_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_PRICO_2014_23_old_mort_strata.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_rec_mort_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_PRICO_2014_23_rec_mort_strata.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_old_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_old_mort_region.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_rec_mort_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_rec_mort_region.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_old_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_old_mort_species_region.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_rec_mort_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_rec_mort_species_region.csv", row.names = F)
# Sometimes you can run the usethis::use_data code in the console but not in the Rmd, not sure why it is so picky. Otherwise, just use save(). 
# usethis::use_data(NCRMP_PRICO_2014_21_rec_mort_site,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_rec_mort_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_rec_mort_site.rda")
# usethis::use_data(NCRMP_PRICO_2014_21_old_mort_site,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_old_mort_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_old_mort_site.rda")
# usethis::use_data(NCRMP_PRICO_2014_21_rec_mort_strata,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_rec_mort_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_rec_mort_strata.rda")
# 
# usethis::use_data(NCRMP_PRICO_2014_21_old_mort_strata,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_old_mort_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_old_mort_strata.rda")
# usethis::use_data(NCRMP_PRICO_2014_21_rec_mort_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_rec_mort_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_rec_mort_region.rda")
# usethis::use_data(NCRMP_PRICO_2014_21_old_mort_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_old_mort_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_old_mort_region.rda")
# usethis::use_data(NCRMP_PRICO_2014_23_old_mort_species_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_old_mort_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_old_mort_species_region.rda")
#usethis::use_data(NCRMP_PRICO_2014_23_rec_mort_species_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_rec_mort_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_rec_mort_species_region.rda")
```
###### Mortality t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_PRICO_2014_23_old_mort_region,
                    metric1 = "old_mortality",
                    metric2 = 'avMort',
                    alpha = 0.05,
                    n_years = 5,
                    test_type = "Years",
                    return_dataframe = FALSE)
NCRMP_perform_ttest(dataframe = NCRMP_PRICO_2014_23_rec_mort_region,
                    metric1 = "recent_mortality",
                    metric2 = 'avMort',
                    alpha = 0.05,
                    n_years = 5,
                    test_type = "Years",
                    return_dataframe = FALSE)
```
##### Disease and bleaching 
```{r}
tmp <- NCRMP_DRM_calculate_disease_prevalence_colonies(project = "NCRMP",
                                                       region = "PRICO",
                                                       species_filter = "FALSE")
NCRMP_PRICO_2014_23_dis_ble_prev_species <- tmp$dis_ble_prev_species
NCRMP_PRICO_2014_23_dis_ble_prev_site <- tmp$dis_ble_prev_site
NCRMP_PRICO_2014_23_dis_prev_strata <- tmp$dis_prev_strata
NCRMP_PRICO_2014_23_ble_prev_strata <- tmp$ble_prev_strata
NCRMP_PRICO_2014_23_dis_ble_prev_region <- tmp$Domain_est
# Export data
write.csv(NCRMP_PRICO_2014_23_dis_ble_prev_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Species level metrics\\NCRMP_PRICO_2014_23_dis_ble_prev_species.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_dis_ble_prev_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_PRICO_2014_23_dis_ble_prev_site.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_dis_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_PRICO_2014_23_dis_prev_strata.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_ble_prev_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_PRICO_2014_23_ble_prev_strata.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_dis_ble_prev_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_dis_ble_prev_region.csv", row.names = F)
#usethis::use_data(NCRMP_PRICO_2014_21_dis_ble_prev_species,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_dis_ble_prev_species, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_dis_ble_prev_species.rda")
# usethis::use_data(NCRMP_PRICO_2014_21_dis_ble_prev_site,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_dis_ble_prev_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_dis_ble_prev_site.rda")
# usethis::use_data(NCRMP_PRICO_2014_21_dis_prev_strata,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_dis_prev_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_dis_prev_strata.rda")
# usethis::use_data(NCRMP_PRICO_2014_21_ble_prev_strata,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_ble_prev_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_ble_prev_strata.rda")
 
# usethis::use_data(NCRMP_PRICO_2014_21_dis_ble_prev_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_dis_ble_prev_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_dis_ble_prev_region.rda")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_dis_ble_prevalence_species_domain(project="NCRMP",
                                                             region = "PRICO")
NCRMP_PRICO_2014_23_dis_prev_species_region <- tmp$DomainEst_dis
NCRMP_PRICO_2014_23_ble_prev_species_region <- tmp$DomainEst_bl
# ntot check - wh_total should always be 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check$wh_total)
write.csv(NCRMP_PRICO_2014_23_dis_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_dis_prev_species_region.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_ble_prev_species_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_ble_prev_species_region.csv", row.names = F)
#usethis::use_data(NCRMP_PRICO_2014_21_dis_prev_species_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_dis_prev_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_dis_prev_species_region.rda")
#usethis::use_data(NCRMP_PRICO_2014_21_ble_prev_species_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_ble_prev_species_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_ble_prev_species_region.rda")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tmp <- NCRMP_DRM_calculate_disease_prevalence_sites(project = "NCRMP",
                                                    region = "PRICO",
                                                    species_filter = "FALSE")
NCRMP_PRICO_2014_23_dis_ble_PA_site <- tmp$dis_ble_prev_site
NCRMP_PRICO_2014_23_dis_n_sites_per_strata <- tmp$dis_ble_prev_strata
NCRMP_PRICO_2014_23_dis_ble_n_sites_per_region <- tmp$disease_prev_region
write.csv(NCRMP_PRICO_2014_23_dis_ble_PA_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_PRICO_2014_23_dis_ble_PA_site.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_dis_n_sites_per_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_PRICO_2014_23_dis_n_sites_per_strata.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_dis_ble_n_sites_per_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_dis_ble_n_sites_per_region.csv", row.names = F)
#usethis::use_data(NCRMP_PRICO_2014_21_dis_ble_PA_site,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_dis_ble_PA_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_dis_ble_PA_site.rda")
#usethis::use_data(NCRMP_PRICO_2014_21_dis_n_sites_per_strata,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_dis_n_sites_per_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_dis_n_sites_per_strata.rda")
#usethis::use_data(NCRMP_PRICO_2014_21_dis_ble_n_sites_per_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_dis_ble_n_sites_per_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_dis_ble_n_sites_per_region.rda")
```
##### Colony size
```{r}
tmp <- NCRMP_DRM_calculate_mean_colony_size(project = "NCRMP",
                                            region = "PRICO",
                                            species_filter = "FALSE")
NCRMP_PRICO_2014_23_col_size_species <- tmp$size_species
NCRMP_PRICO_2014_23_col_size_site <- tmp$size_site
NCRMP_PRICO_2014_23_col_size_cm2_strata <- tmp$size_est_cm2_strata
NCRMP_PRICO_2014_23_col_size_cm3_strata <- tmp$size_est_cm3_strata
NCRMP_PRICO_2014_23_col_size_region <- tmp$Domain_est
NCRMP_PRICO_2014_23_col_size_region_species <- tmp$Domain_est_species
# check ntot weighting for species-specific mortality - should only be values of 1 (sum of weights across strata for each species in each year)
unique(tmp$ntot_check_species$wh_sum)
# Export data
write.csv(NCRMP_PRICO_2014_23_col_size_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Species level metrics\\NCRMP_PRICO_2014_23_col_size_species.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_col_size_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Site level metrics\\NCRMP_PRICO_2014_23_col_size_site.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_col_size_cm2_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_PRICO_2014_23_col_size_cm2_strata.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_col_size_cm3_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Strata level metrics\\NCRMP_PRICO_2014_23_col_size_cm3_strata.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_col_size_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_23_col_size_region.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_col_size_region_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Domain estimates\\NCRMP_PRICO_2014_21_col_size_region_species.csv", row.names = F)
# copy to console and run
#usethis::use_data(NCRMP_PRICO_2014_21_col_size_species,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_col_size_species, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_col_size_species.rda")
#usethis::use_data(NCRMP_PRICO_2014_21_col_size_site,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_col_size_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_col_size_site.rda")
#usethis::use_data(NCRMP_PRICO_2014_21_col_size_cm2_strata,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_col_size_cm2_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_col_size_cm2_strata.rda")
#usethis::use_data(NCRMP_PRICO_2014_21_col_size_cm3_strata,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_col_size_cm3_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_col_size_cm3_strata.rda")
#usethis::use_data(NCRMP_PRICO_2014_21_col_size_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_col_size_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_col_size_region.rda")
# usethis::use_data(NCRMP_PRICO_2014_23_col_size_region_species,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_col_size_region_species, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_col_size_region_species.rda")
```
###### Colony size t-test
```{r}
NCRMP_perform_ttest(dataframe = NCRMP_PRICO_2014_23_col_size_region,
                    metric1 = 'colony_size',
                    metric2 = 'avCm3',
                    alpha = 0.05,
                    n_years = 5,
                    test_type = "Years",
                    return_dataframe = FALSE)
```
##### Diadema density
```{r}
# Run function and assign names to dataframes 
tmp <- NCRMP_calculate_invert_density(region = "PRICO")
NCRMP_PRICO_2014_23_invert_den_site <- tmp$diadema_density_site
NCRMP_PRICO_2014_23_invert_den_strata <- tmp$invert_strata # Right now just diadema
NCRMP_PRICO_2014_23_invert_den_region <- tmp$Domain_est
# Export data 
write.csv(NCRMP_PRICO_2014_23_invert_den_site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_PRICO_2014_23_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_invert_den_strata, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_PRICO_2014_23_invert_den_strata.csv", row.names = F)
write.csv(NCRMP_PRICO_2014_23_invert_den_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Invertebrates\\NCRMP_PRICO_2014_23_invert_den_region.csv", row.names = F)
# usethis::use_data(NCRMP_PRICO_2014_21_invert_den_site,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_invert_den_site, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_invert_den_site.rda")
# usethis::use_data(NCRMP_PRICO_2014_21_invert_den_strata,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_invert_den_strata, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_invert_den_strata.rda")
# usethis::use_data(NCRMP_PRICO_2014_21_invert_den_region,  overwrite = TRUE)
save(NCRMP_PRICO_2014_23_invert_den_region, file = "~/Desktop/OneDrive - University of Miami/NOAA_NCRMP/ncrmp.benthics.analysis/data/NCRMP_PRICO_2014_23_invert_den_region.rda")
```








# ESA Corals P/A
```{r}
tmp <- NCRMP_calculate_ESA_corals_PresAbs()

NCRMP_AllRegions_Years_ESA_PresAbs_Strat <- tmp$NCRMP_AllRegions_Years_ESA_PresAbs_Strat
NCRMP_AllRegions_Years_ESA_PresAbs_Site <- tmp$NCRMP_AllRegions_Years_ESA_PresAbs_Site

region_year <- tmp$region_year # Check to make sure every region/year is accounted for 

write.csv(NCRMP_AllRegions_Years_ESA_PresAbs_Strat, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\ESA species\\NCRMP_AllRegions_Years_ESA_PresAbs_Strat.csv", row.names = F)
write.csv(NCRMP_AllRegions_Years_ESA_PresAbs_Site, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\ESA species\\NCRMP_AllRegions_Years_ESA_PresAbs_Site.csv", row.names = F)

usethis::use_data(NCRMP_AllRegions_Years_ESA_PresAbs_Strat,  overwrite = TRUE)
#save(NCRMP_AllRegions_Years_ESA_PresAbs_Strat, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_AllRegions_Years_ESA_PresAbs_Strat.rda")
usethis::use_data(NCRMP_AllRegions_Years_ESA_PresAbs_Site,  overwrite = TRUE)
#save(NCRMP_AllRegions_Years_ESA_PresAbs_Site, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_AllRegions_Years_ESA_PresAbs_Site.rda")
```
# ESA FOI 
```{r}
tmp <- NCRMP_make_ESA_corals_FOI()

NCRMP_ESA_FOI_region <- tmp$FOI_region
NCRMP_ESA_FOI_species <- tmp$FOI_species

write.csv(NCRMP_ESA_FOI_region, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\ESA species\\NCRMP_ESA_FOI_region.csv", row.names = F)
write.csv(NCRMP_ESA_FOI_species, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\ESA species\\NCRMP_ESA_FOI_species.csv", row.names = F)

usethis::use_data(NCRMP_ESA_FOI_region,  overwrite = TRUE)
usethis::use_data(NCRMP_ESA_FOI_species,  overwrite = TRUE)

#save(NCRMP_ESA_FOI_region, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_ESA_FOI_region.rda")
#save(NCRMP_ESA_FOI_species, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_ESA_FOI_species.rda")
```

# Bleaching abundance 
```{r}
# If updating with a new year, you need to run the below code chunk to update
# NCRMP_demo_All_regions_years first 
tmp <- NCRMP_make_bleaching_abundance()
NCRMP_bleaching_abundance_Allyears_Allregions <- tmp$NCRMP_bleaching_abundance_Allyears_Allregions
write.csv(NCRMP_bleaching_abundance_Allyears_Allregions, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Data Queries\\R Package Exports\\Bleaching and Disease\\NCRMP_bleaching_abundance_Allyears_Allregions.csv", row.names = F)
#save(NCRMP_bleaching_abundance_Allyears_Allregions, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_bleaching_abundance_Allyears_Allregions.rda")
```
# Combine regions
## Coral demographics
```{r}
tmp  <- dplyr::bind_rows(SEFCRI_2014_2stage_coral_demographics,
                         SEFCRI_2016_coral_demographics,
                         SEFCRI_2018_coral_demographics,
                         SEFCRI_2020_coral_demographics,
                         SEFCRI_2022_coral_demographics,
                         FLK_2014_coral_demographics,
                         FLK_2016_coral_demographics,
                         FLK_2018_coral_demographics %>% dplyr::mutate(RUGOSITY_CD = as.logical(RUGOSITY_CD)),
                         FLK_2020_coral_demographics,
                         FLK_2022_coral_demographics,
                         TortugasMarq_2014_coral_demographics,
                         TortugasMarq_2016_coral_demographics,
                         Tortugas_2018_coral_demographics,
                         Tortugas_2020_coral_demographics,
                         Tortugas_2022_coral_demographics,
                         USVI_2013_coral_demographics,
                         USVI_2015_coral_demographics,
                         USVI_2017_coral_demographics,
                         USVI_2019_coral_demographics,
                         USVI_2021_coral_demographics,
			                  USVI_2023_coral_demographics,
                         PRICO_2014_coral_demographics,
                         PRICO_2016_coral_demographics,
                         PRICO_2019_coral_demographics,
                         PRICO_2021_coral_demographics,
			                    PRICO_2023_coral_demographics) %>%
  # Combine and change to factor - there are letters in the FGBNMS MAPGRID NRs
  dplyr::mutate(MAPGRID_NR = as.factor(MAPGRID_NR))
NCRMP_demo_All_regions_years <- tmp %>%
  dplyr::bind_rows(
    FGBNMS_2013_coral_demographics %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR)),
    FGBNMS_2015_coral_demographics %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR)),
    FGBNMS_2018_coral_demographics %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR)),
    FGBNMS_2022_coral_demographics %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR)),
    FGBNMS_2024_coral_demographics %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR))
  )
write.csv(NCRMP_demo_All_regions_years, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Combined Regions and Years\\NCRMP_demo_All_regions_years.csv", row.names = F)
#write.csv(NCRMP_demo_All_regions_years, "C:\\Users\\Lexie.Sturm\\Documents\\NCRMP Files\\NCRMP_demo_All_regions_years.csv", row.names = F)
#usethis::use_data(NCRMP_demo_All_regions_years,  overwrite = TRUE)
save(NCRMP_demo_All_regions_years, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_demo_All_regions_years.rda")
```
## Benthic cover
```{r}
tmp  <- dplyr::bind_rows(SEFCRI_2014_2stage_benthic_cover,
                         SEFCRI_2016_benthic_cover,
                         SEFCRI_2018_benthic_cover,
                         SEFCRI_2020_benthic_cover,
                         SEFCRI_2022_benthic_cover,
                         FLK_2014_2stage_benthic_cover,
                         FLK_2016_benthic_cover,
                         FLK_2018_coral_demographics %>% dplyr::mutate(RUGOSITY_CD = as.logical(RUGOSITY_CD)),
                         FLK_2020_benthic_cover,
                         FLK_2022_benthic_cover,
                         TortugasMarq_2014_benthic_cover,
                         TortugasMarq_2016_benthic_cover,
                         Tortugas_2018_benthic_cover,
                         Tortugas_2020_benthic_cover,
                         Tortugas_2022_benthic_cover,
                         USVI_2013_benthic_cover,
                         USVI_2015_benthic_cover,
                         USVI_2017_benthic_cover,
                         USVI_2019_benthic_cover,
                         USVI_2021_benthic_cover,
			                   USVI_2023_benthic_cover,
                         PRICO_2014_benthic_cover,
                         PRICO_2016_benthic_cover,
                         PRICO_2019_benthic_cover,
                         PRICO_2021_benthic_cover,
                         PRICO_2023_benthic_cover) %>%
  # Combine and change to factor - there are letters in the FGBNMS MAPGRID NRs
  dplyr::mutate(MAPGRID_NR = as.factor(MAPGRID_NR))
NCRMP_benthic_cover_All_regions_years <- tmp %>%
  dplyr::bind_rows(
    FGBNMS_2013_benthic_cover %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR)),
    FGBNMS_2015_benthic_cover %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR)),
    FGBNMS_2018_benthic_cover %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR)),
    FGBNMS_2022_benthic_cover %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR)),
    FGBNMS_2024_benthic_cover %>% dplyr::mutate(MAPGRID_NR = as.character(MAPGRID_NR))
  )
write.csv(NCRMP_benthic_cover_All_regions_years, "K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\Combined Regions and Years\\NCRMP_benthic_cover_All_regions_years.csv", row.names = F)
#write.csv(NCRMP_benthic_cover_All_regions_years, "C:\\Users\\Lexie.Sturm\\Documents\\NCRMP Files\\NCRMP_benthic_cover_All_regions_years.csv", row.names = F)
#usethis::use_data(NCRMP_benthic_cover_All_regions_years,  overwrite = TRUE)
save(NCRMP_benthic_cover_All_regions_years, file = "C:/Users/Lexie.Sturm/Documents/ncrmp/ncrmp.benthics.analysis/data/NCRMP_benthic_cover_All_regions_years.rda")
```




#### DRM+SCREAM pre NCRMP metrics
```{r}

SCREAM_coral_density <- function(project, species_filter = FALSE, start_year, end_year ){
  
  call_data <- DRM_SCREAM_calculate_colony_density(project = project, 
                                           species_filter = "FALSE")
  
    prep_csv <- function(dataset_name_string, dataset, location){
    
    
    file_name <- paste(project, "FL", start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
    }
   
  prep_csv("density_site", call_data$density_site, site_level_metrics)  
  prep_csv("density_strata", call_data$density_strata, strata_level_metrics)  
  prep_csv("density_region", call_data$Domain_est, domain_est)
  
      if (project == "DRM_SCREAM" || project == "SCREAM"){
      prep_csv("density_species", call_data$density_species, species_level_metrics) 
    }
}

SCREAM_coral_density(project = "DRM_SCREAM", start_year = 1999, end_year = 13)

```

####SCREAM Mortality
```{r}

SCREAM_mortality <- function( project, start_year, end_year ){
  
  call_data <- DRM_SCREAM_calculate_mortality(project = project, species_filter = "FALSE")
  
  prep_csv <- function(dataset_name_string, dataset, location){
    
    
    file_name <- paste(project, "FL", start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")

    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }

  prep_csv("old_mort_site", call_data$old_mortality_site, site_level_metrics)  
  prep_csv("rec_mort_site", call_data$recent_mortality_site, site_level_metrics)  
  prep_csv("old_mort_strata", call_data$old_mortality_strata, strata_level_metrics)  
  prep_csv("rec_mort_strata", call_data$rec_mortality_strata, strata_level_metrics)  
  prep_csv("old_mort_region", call_data$Domain_est_old_mort, domain_est)
  prep_csv("rec_mort_region", call_data$Domain_est_rec_mort, site_level_metrics)
  #prep_csv("old_mort_species_region", call_data$Domain_est_old_mort_species, strata_level_metrics)
  #prep_csv("rec_mort_species_region", call_data$Domain_est_rec_mort_species, domain_est)

}

SCREAM_mortality( project = "DRM_SCREAM",  start_year = 1999, end_year =13 )
```

####SCREAM Disease
```{r}
SCREAM_disease_prev_colonies <- function(project,  start_year, end_year ){
  
  call_data <- DRM_SCREAM_calculate_disease_prevalence(project = project,
                                                      
                                                       species_filter = "FALSE")
  
  
  prep_csv <- function(dataset_name_string, dataset, location){

    file_name <- paste(project, "FL", start_year, end_year, dataset_name_string, sep = "_")    
    assign(file_name, value = dataset, envir = .GlobalEnv)
    make_data_path <- paste(paste(location, dataset_name_string, sep = "\\"), "csv", sep = ".")
    write_csv(get(file_name), make_data_path)
    final_data <- get(file_name)
    usethis::use_data(final_data, overwrite = TRUE)
  }

 # prep_csv("dis_ble_prev_species", call_data$dis_ble_prev_species, species_level_metrics) 
  prep_csv("dis_prev_site", call_data$disease_prev_site, site_level_metrics)  
  prep_csv("dis_prev_strata", call_data$unwh_dis_prev_strata, strata_level_metrics)  
  #prep_csv("ble_prev_strata", call_data$ble_prev_strata, strata_level_metrics)
  prep_csv("dis_prev_region", call_data$Domain_est, domain_est)
  

}

SCREAM_disease_prev_colonies( project = "DRM", start_year = 1999, end_year =13)
```

## Combine preNCRMP AR DRM and SCREAM data 
```{r SCREAM}
# Temporarily set the SCREAM file as the wd. It will revert back to the parent folder as soon
# as the chunk is done running.
setwd("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\SCREAM")
files <- list.files(pattern="*.csv")
SCREAM = do.call(rbind, lapply(files, function(x) read.csv(x, stringsAsFactors = FALSE)))
SCREAM <- SCREAM %>%
  mutate(SURVEY = "SCREAM",
         PRIMARY_SAMPLE_UNIT = as.factor(PRIMARY_SAMPLE_UNIT))
```
```{r DRM}
# Temporarily set the SCREAM file as the wd. It will revert back to the parent folder as soon
# as the chunk is done running.
setwd("K:\\_BioGeoProjects\\NCRMP\\Data Analysis\\Analysis ready data\\FL\\FRRP")
files <- list.files(pattern="*2stage_coral_demographics.csv")
DRM = do.call(rbind, lapply(files, function(x) read.csv(x, stringsAsFactors = FALSE)))
DRM <- DRM %>%
  mutate(SURVEY = "DRM",
         PRIMARY_SAMPLE_UNIT = as.factor(PRIMARY_SAMPLE_UNIT)) %>%
  filter(YEAR < 2014)
```
### Combine 
```{r DRM}
preNCRMP_SCREAM_DRM_coral_demographics <- as.data.frame(dplyr::bind_rows(SCREAM, DRM))
usethis::use_data(preNCRMP_SCREAM_DRM_coral_demographics, overwrite = TRUE)
```
